# XS-002 å¯è¡Œæ€§åˆ†ææŠ¥å‘Šï¼šTurbo æ›¿ä»£ Nx ä¸åç«¯ä»£ç æå–

## æ–‡æ¡£ä¿¡æ¯

- **æ–‡æ¡£ç¼–å·**: XS-002
- **æ–‡æ¡£æ ‡é¢˜**: å¯è¡Œæ€§åˆ†ææŠ¥å‘Šï¼šTurbo æ›¿ä»£ Nx ä¸åç«¯ä»£ç æå–
- **åˆ›å»ºæ—¥æœŸ**: 2024-12-19
- **æ–‡æ¡£ç±»å‹**: è¯¦ç»†è®¾è®¡æ–‡æ¡£
- **çŠ¶æ€**: å¾…è¯„å®¡

---

## 1. æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šåˆ†æäº†åœ¨ oksai.api é¡¹ç›®ä¸­ï¼š
1. ä½¿ç”¨ **Turbo** æ›¿ä»£ **Nx** ä½œä¸ºæ„å»ºå·¥å…·çš„å¯è¡Œæ€§
2. ä» **ever-gauzy** å‚è€ƒé¡¹ç›®ä¸­**ä»…æå–åç«¯ï¼ˆæœåŠ¡ç«¯ï¼‰ä»£ç **çš„å¯è¡Œæ€§
3. **ç®€åŒ– ORM å±‚**ï¼šä½¿ç”¨ MikroORM æ›¿ä»£ TypeORMï¼Œç§»é™¤ ORM æŠ½è±¡å±‚ï¼Œä¸éœ€è¦æ”¯æŒå¤šORM
4. **æ•°æ®åº“æ”¯æŒ**ï¼šä½¿ç”¨ MikroORM é€‚é… PostgreSQLã€MongoDBã€Better-SQLite ä¸‰ç§æ•°æ®åº“ï¼ˆæ³¨ï¼šé¡¹ç›®ç« ç¨‹ä¸­"å…³ç³»å‹æ•°æ®åº“é€‰å‹é”å®š PostgreSQL"ä¸»è¦é’ˆå¯¹å…³ç³»å‹æ•°æ®åº“ï¼Œæœ¬é¡¹ç›®åŒæ—¶æ”¯æŒå…³ç³»å‹å’Œæ–‡æ¡£å‹æ•°æ®åº“ï¼‰

**é¡¹ç›®å®šä½**ï¼šoksai.api æ˜¯ä¸€ä¸ª**çº¯åç«¯åº”ç”¨**ï¼Œä¸“æ³¨äºæä¾› REST API å’Œ GraphQL API æœåŠ¡ï¼Œä¸åŒ…å«ä»»ä½•å‰ç«¯å®ç°ã€‚

**é¡¹ç›®ç›®æ ‡**ï¼ˆæ ¹æ®é¡¹ç›®ç« ç¨‹ï¼‰ï¼š
- å¯¹æ ‡ `examples/ever-gauzy` é¡¹ç›®ï¼Œå¼€å‘ä¸€ä¸ªæœ€å°å·®å¼‚ç‰ˆæœ¬çš„çº¯åç«¯ API æœåŠ¡åº”ç”¨
- ä» `examples/ever-gauzy` é¡¹ç›®ä¸­æå–å‡ºçº¯åç«¯ API æœåŠ¡åº”ç”¨çš„ä»£ç 
- å¯¹é½ `examples/ever-gauzy` é¡¹ç›®åç«¯ä»£ç çš„ç»“æ„å’Œå®ç°
- **ç®€åŒ– ORM å±‚**ï¼šä½¿ç”¨ MikroORM æ›¿ä»£ TypeORMï¼Œ**ä¸éœ€è¦æ”¯æŒå¤šORM**
- ä½¿ç”¨ **Turbo** æ›¿ä»£ **Nx** ä½œä¸ºæ„å»ºå·¥å…·
- **æ•°æ®åº“æ”¯æŒ**ï¼šä½¿ç”¨ MikroORM é€‚é… PostgreSQLï¼ˆå…³ç³»å‹ï¼‰ã€MongoDBï¼ˆæ–‡æ¡£å‹ï¼‰ã€Better-SQLiteï¼ˆå…³ç³»å‹ï¼‰ä¸‰ç§æ•°æ®åº“

**ç»“è®º**ï¼šæ‰€æœ‰ç›®æ ‡å‡**é«˜åº¦å¯è¡Œ**ï¼Œä¸”ç¬¦åˆé¡¹ç›®æŠ€æœ¯æ ˆå’Œæ¶æ„ç›®æ ‡ã€‚æœ¬é¡¹ç›®å°†ä½œä¸ºçº¯åç«¯æœåŠ¡ï¼Œä¸ºå‰ç«¯æˆ–å…¶ä»–å®¢æˆ·ç«¯æä¾› API æ¥å£ã€‚

**é‡è¦è¯´æ˜**ï¼š
- æœ¬é¡¹ç›®æ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹ï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚
- PostgreSQL ä½œä¸ºä¸»è¦å…³ç³»å‹æ•°æ®åº“ï¼ˆç¬¦åˆé¡¹ç›®ç« ç¨‹è¦æ±‚ï¼‰
- MongoDB ä½œä¸ºæ–‡æ¡£å‹æ•°æ®åº“æ”¯æŒï¼ˆé€‚ç”¨äºç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼‰
- Better-SQLite ä½œä¸ºè½»é‡çº§å…³ç³»å‹æ•°æ®åº“æ”¯æŒï¼ˆé€‚ç”¨äºå¼€å‘ã€æµ‹è¯•æˆ–å°å‹éƒ¨ç½²ï¼‰

---

## 2. é¡¹ç›®èƒŒæ™¯

### 2.1 å½“å‰é¡¹ç›®çŠ¶æ€

- **é¡¹ç›®åç§°**: oksai.api
- **é¡¹ç›®ç±»å‹**: Monorepoï¼ˆä½¿ç”¨ pnpm workspaceï¼‰
- **é¡¹ç›®å®šä½**: **çº¯åç«¯åº”ç”¨**ï¼Œä¸åŒ…å«å‰ç«¯å®ç°
  - æœ¬é¡¹ç›®ä¸“æ³¨äºåç«¯ API æœåŠ¡çš„å¼€å‘
  - ä¸åŒ…å«ä»»ä½•å‰ç«¯ä»£ç ã€UI ç»„ä»¶æˆ–å‰ç«¯åº”ç”¨
  - æä¾› REST API å’Œ GraphQL API ä¾›å‰ç«¯æˆ–å…¶ä»–å®¢æˆ·ç«¯è°ƒç”¨
- **æŠ€æœ¯æ ˆ**: NestJS + TypeScript
- **æ•°æ®åº“**: PostgreSQLã€MongoDBã€Better-SQLiteï¼ˆä½¿ç”¨ MikroORM é€‚é…ï¼‰
- **ORM**: MikroORMï¼ˆå”¯ä¸€æ•°æ®è®¿é—®å±‚ï¼Œä¸ä½¿ç”¨ TypeORMï¼‰
- **æ„å»ºå·¥å…·**: Turboï¼ˆå·²é…ç½®ï¼‰
- **æ¶æ„æ¨¡å¼**: åˆ†å±‚æ¶æ„ï¼ˆController-Service-Repositoryï¼‰+ CQRS + äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰
  - **è¯´æ˜**: æ¶æ„æ¨¡å¼åŸºäºå‚è€ƒé¡¹ç›® ever-gauzy çš„å®é™…å®ç°
  - **åˆ†å±‚æ¶æ„**: æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼Œæ¯ä¸ªæ¨¡å—åŒ…å« entityã€serviceã€repositoryã€controllerã€commands ç­‰
  - **CQRS**: ä½¿ç”¨ `@nestjs/cqrs`ï¼Œå®ç°äº† Command å’Œ CommandHandler æ¨¡å¼
  - **äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰**: å®ç°äº†äº‹ä»¶æ€»çº¿ï¼ˆEventBusï¼‰ï¼ŒåŸºäº RxJS Subject çš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼
  - **å‚è€ƒé¡¹ç›®**: ever-gauzy å®ç°äº† EDAï¼ˆäº‹ä»¶æ€»çº¿ + å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼‰ï¼Œä½†æœªå®ç°å®Œæ•´çš„äº‹ä»¶æº¯æºï¼ˆESï¼‰ï¼Œäº‹ä»¶ä»…åœ¨å†…å­˜ä¸­æµè½¬
  - **æ‰©å±•è®¡åˆ’**: å¦‚éœ€è¦å®Œæ•´çš„äº‹ä»¶æº¯æºï¼ˆESï¼‰ï¼Œéœ€åœ¨æå–åè‡ªè¡Œå®ç°äº‹ä»¶å­˜å‚¨å’Œé‡æ”¾æœºåˆ¶

### 2.2 å‚è€ƒé¡¹ç›®åˆ†æ

**ever-gauzy** æ˜¯ä¸€ä¸ªä¼ä¸šçº§ä¸šåŠ¡ç®¡ç†å¹³å°ï¼ˆERP/CRM/HRM/ATS/PMï¼‰ï¼ŒåŒ…å«ï¼š
- **å‰ç«¯**: Angular åº”ç”¨ï¼ˆ`apps/gauzy`ã€`apps/desktop` ç­‰ï¼‰
- **åç«¯**: NestJS APIï¼ˆ`apps/api` ä¸ºä¸»ï¼Œè¿˜æœ‰ `apps/desktop-api`ã€`apps/server-api` ç­‰ï¼‰
- **å…±äº«åº“**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆ`packages/core`ã€`packages/auth` ç­‰ï¼‰
- **æ„å»ºå·¥å…·**: Nx + Lernaï¼ˆLerna ä½¿ç”¨ Nx ä½œä¸ºåç«¯ï¼‰ï¼ˆLerna ä½¿ç”¨ Nx ä½œä¸ºåç«¯ï¼Œ`lerna.json` ä¸­ `"useNx": true`ï¼‰
- **åŒ…ç®¡ç†**: Yarn
- **ORM**: åŒæ—¶ä½¿ç”¨ TypeORM å’Œ MikroORMï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ï¼ˆPostgreSQLã€MongoDBã€MySQLã€Better-SQLiteï¼‰
- **æ¶æ„æ¨¡å¼**: åˆ†å±‚æ¶æ„ï¼ˆController-Service-Repositoryï¼‰+ CQRS + äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰
  - **åˆ†å±‚æ¶æ„**: æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼ˆå¦‚ userã€employeeã€organization ç­‰ï¼‰ï¼Œæ¯ä¸ªæ¨¡å—åŒ…å« entityã€serviceã€repositoryã€controllerã€commands ç­‰
  - **CQRS**: ä½¿ç”¨ `@nestjs/cqrs`ï¼Œå®ç°äº† Command å’Œ CommandHandler æ¨¡å¼ï¼ˆå¦‚ `UserCreateCommand`ã€`UserCreateHandler`ï¼‰
  - **äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰**: å®ç°äº†äº‹ä»¶æ€»çº¿ï¼ˆEventBusï¼‰ï¼ŒåŸºäº RxJS Subject çš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œæ”¯æŒè·¨æ¨¡å—äº‹ä»¶é€šä¿¡
  - **æ³¨æ„**: ever-gauzy **æœªå®ç°**å®Œæ•´çš„äº‹ä»¶æº¯æºï¼ˆESï¼‰ï¼Œäº‹ä»¶ä»…åœ¨å†…å­˜ä¸­æµè½¬ï¼ŒæœªæŒä¹…åŒ–å­˜å‚¨

**æœ¬é¡¹ç›®æå–ç­–ç•¥**ï¼š
- âœ… **ä»…æå–åç«¯ä»£ç **ï¼šä» ever-gauzy ä¸­ä»…æå–åç«¯ API å’Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- âŒ **ä¸æå–å‰ç«¯ä»£ç **ï¼šä¸åŒ…å«ä»»ä½• Angular åº”ç”¨ã€UI ç»„ä»¶æˆ–å‰ç«¯ç›¸å…³ä»£ç 
- âœ… **ä¿æŒåç«¯ç‹¬ç«‹æ€§**ï¼šç¡®ä¿æå–çš„åç«¯ä»£ç ä¸ä¾èµ–ä»»ä½•å‰ç«¯åŒ…æˆ– UI åº“

---

## 3. å¯è¡Œæ€§åˆ†æï¼šTurbo æ›¿ä»£ Nx

### 3.1 Nx vs Turbo åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ç‰¹æ€§ | Nx | Turbo | æœ¬é¡¹ç›®éœ€æ±‚ |
|---------|-----|-------|-----------|
| **æ„å»ºç¼“å­˜** | âœ… æ”¯æŒ | âœ… æ”¯æŒ | âœ… å¿…éœ€ |
| **ä»»åŠ¡ç¼–æ’** | âœ… æ”¯æŒ | âœ… æ”¯æŒ | âœ… å¿…éœ€ |
| **ä¾èµ–å›¾åˆ†æ** | âœ… å†…ç½® | âš ï¸ éœ€æ’ä»¶ | âš ï¸ å¯é€‰ |
| **ä»£ç ç”Ÿæˆå™¨** | âœ… å†…ç½® | âŒ ä¸æ”¯æŒ | âŒ ä¸éœ€è¦ |
| **ä»£ç æ£€æŸ¥** | âœ… å†…ç½® | âš ï¸ éœ€é…ç½® | âœ… å·²é…ç½® ESLint |
| **æµ‹è¯•è¿è¡Œ** | âœ… å†…ç½® | âœ… æ”¯æŒ | âœ… å¿…éœ€ |
| **å¹¶è¡Œæ‰§è¡Œ** | âœ… æ”¯æŒ | âœ… æ”¯æŒ | âœ… å¿…éœ€ |
| **å¢é‡æ„å»º** | âœ… æ”¯æŒ | âœ… æ”¯æŒ | âœ… å¿…éœ€ |
| **å­¦ä¹ æ›²çº¿** | è¾ƒé™¡ | è¾ƒå¹³ | ä¼˜å…ˆé€‰æ‹© |
| **é…ç½®å¤æ‚åº¦** | è¾ƒé«˜ | è¾ƒä½ | ä¼˜å…ˆé€‰æ‹© |
| **æ€§èƒ½** | ä¼˜ç§€ | ä¼˜ç§€ | æ»¡è¶³éœ€æ±‚ |

### 3.2 æŠ€æœ¯å¯è¡Œæ€§åˆ†æ

#### âœ… **é«˜åº¦å¯è¡Œ**

**ç†ç”±**ï¼š

1. **æ ¸å¿ƒåŠŸèƒ½å¯¹é½**
   - Turbo å®Œå…¨æ”¯æŒ monorepo çš„æ„å»ºç¼“å­˜å’Œä»»åŠ¡ç¼–æ’
   - é¡¹ç›®å·²é…ç½® Turboï¼ŒåŸºç¡€æ¶æ„å·²å°±ç»ª
   - Turbo çš„ç¼“å­˜æœºåˆ¶ä¸ Nx ç›¸å½“ï¼Œæ€§èƒ½ä¼˜å¼‚

2. **é¡¹ç›®éœ€æ±‚åŒ¹é…**
   - æœ¬é¡¹ç›®ä¸º**çº¯åç«¯é¡¹ç›®**ï¼Œä¸éœ€è¦ Nx çš„ Angular/React ä»£ç ç”Ÿæˆå™¨
   - ä»£ç æ£€æŸ¥å·²é€šè¿‡ ESLint é…ç½®å®Œæˆ
   - ä¾èµ–å›¾åˆ†æå¯é€šè¿‡ `turbo run build --graph` æˆ–ç¬¬ä¸‰æ–¹å·¥å…·å®ç°

3. **è¿ç§»æˆæœ¬ä½**
   - æ— éœ€å¼•å…¥ Nx çš„å¤æ‚é…ç½®ï¼ˆ`nx.json`ã€`project.json` ç­‰ï¼‰
   - Turbo é…ç½®æ›´ç®€æ´ï¼Œç»´æŠ¤æˆæœ¬æ›´ä½
   - å›¢é˜Ÿå­¦ä¹ æˆæœ¬æ›´ä½

4. **æ€§èƒ½ä¼˜åŠ¿**
   - Turbo ä½¿ç”¨ Rust ç¼–å†™ï¼Œæ„å»ºé€Ÿåº¦æ›´å¿«
   - ç¼“å­˜æœºåˆ¶æˆç†Ÿï¼Œæ”¯æŒè¿œç¨‹ç¼“å­˜
   - ä»»åŠ¡ç¼–æ’çµæ´»ï¼Œæ”¯æŒå¤æ‚çš„ä¾èµ–å…³ç³»

### 3.3 æ½œåœ¨é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|----------|
| **ä¾èµ–å›¾å¯è§†åŒ–ç¼ºå¤±** | ä½ | ä½¿ç”¨ `turbo run build --graph` æˆ– `pnpm list --graph` |
| **ä»£ç ç”Ÿæˆå™¨ç¼ºå¤±** | æ—  | ä½¿ç”¨ NestJS CLI æˆ–è‡ªå®šä¹‰è„šæœ¬ |
| **æ’ä»¶ç”Ÿæ€è¾ƒå°‘** | ä½ | Turbo ç”Ÿæ€è¶³å¤Ÿæˆç†Ÿï¼Œæ»¡è¶³åç«¯é¡¹ç›®éœ€æ±‚ |

### 3.4 å®æ–½å»ºè®®

1. **ä¿ç•™ Turbo é…ç½®**ï¼ˆå·²é…ç½®ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
2. **ä½¿ç”¨ NestJS CLI** æ›¿ä»£ Nx çš„ä»£ç ç”ŸæˆåŠŸèƒ½
3. **é…ç½® Turbo ä»»åŠ¡** è¦†ç›–æ‰€æœ‰æ„å»ºã€æµ‹è¯•ã€å¯åŠ¨åœºæ™¯
4. **å»ºç«‹ CI/CD æµç¨‹** åˆ©ç”¨ Turbo çš„è¿œç¨‹ç¼“å­˜

---

## 4. å¯è¡Œæ€§åˆ†æï¼šä»…æå–åç«¯ä»£ç 

### 4.1 ever-gauzy é¡¹ç›®ç»“æ„åˆ†æ

```
ever-gauzy/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/              âœ… åç«¯ APIï¼ˆNestJSï¼‰
â”‚   â”œâ”€â”€ gauzy/            âŒ å‰ç«¯åº”ç”¨ï¼ˆAngularï¼‰
â”‚   â”œâ”€â”€ desktop/          âŒ æ¡Œé¢åº”ç”¨ï¼ˆElectron + Angularï¼‰
â”‚   â”œâ”€â”€ desktop-timer/    âŒ æ¡Œé¢è®¡æ—¶å™¨ï¼ˆElectronï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/             âœ… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆåç«¯ï¼‰
â”‚   â”œâ”€â”€ auth/             âœ… è®¤è¯æ¨¡å—ï¼ˆåç«¯ï¼‰
â”‚   â”œâ”€â”€ common/           âœ… é€šç”¨å·¥å…·ï¼ˆåç«¯ï¼‰
â”‚   â”œâ”€â”€ config/           âœ… é…ç½®ç®¡ç†ï¼ˆåç«¯ï¼‰
â”‚   â”œâ”€â”€ constants/        âœ… å¸¸é‡å®šä¹‰ï¼ˆåç«¯ï¼‰
â”‚   â”œâ”€â”€ contracts/        âœ… æ¥å£å®šä¹‰ï¼ˆåç«¯ï¼‰
â”‚   â”œâ”€â”€ utils/            âœ… å·¥å…·å‡½æ•°ï¼ˆåç«¯ï¼‰
â”‚   â”œâ”€â”€ ui-core/          âŒ UI æ ¸å¿ƒåº“ï¼ˆå‰ç«¯ï¼‰
â”‚   â”œâ”€â”€ ui-auth/          âŒ UI è®¤è¯åº“ï¼ˆå‰ç«¯ï¼‰
â”‚   â”œâ”€â”€ ui-config/        âŒ UI é…ç½®åº“ï¼ˆå‰ç«¯ï¼‰
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### 4.2 åç«¯ä»£ç è¯†åˆ«

#### âœ… **æ ¸å¿ƒåç«¯åº”ç”¨**

1. **`apps/api/`** - ä¸» API åº”ç”¨
   - å…¥å£æ–‡ä»¶ï¼š`src/main.ts`
   - æ’ä»¶é…ç½®ï¼š`src/plugin-config.ts`
   - æ•°æ®åº“è¿ç§»ï¼š`src/migration.ts`
   - æ•°æ®ç§å­ï¼š`src/seed*.ts`

2. **`packages/core/`** - æ ¸å¿ƒä¸šåŠ¡æ¡†æ¶
   - æ•°æ®åº“æ¨¡å—ï¼ˆ**éœ€è¦ä»åŒ ORM ç®€åŒ–ä¸ºä»…ä½¿ç”¨ MikroORM**ï¼Œæ”¯æŒ PostgreSQLã€MongoDBã€Better-SQLiteï¼‰
     - **æ³¨æ„**: ever-gauzy åŒæ—¶ä½¿ç”¨ TypeORM å’Œ MikroORMï¼Œéœ€è¦ç§»é™¤ TypeORM ç›¸å…³ä»£ç 
     - **æ³¨æ„**: ever-gauzy å¯èƒ½æ²¡æœ‰ç»Ÿä¸€çš„ ORM æŠ½è±¡å±‚ï¼Œè€Œæ˜¯ç›´æ¥åŒæ—¶ä½¿ç”¨ä¸¤ç§ ORM
     - **æå–å**: ç›´æ¥ä½¿ç”¨ MikroORM ä½œä¸ºå”¯ä¸€æ•°æ®è®¿é—®å±‚ï¼Œç§»é™¤æ‰€æœ‰ TypeORM ä¾èµ–å’Œé…ç½®
     - **æ•°æ®åº“æ”¯æŒ**: ä¿ç•™ PostgreSQLã€MongoDBã€Better-SQLite ä¸‰ç§æ•°æ®åº“æ”¯æŒï¼Œç§»é™¤ MySQL æ”¯æŒ
   - GraphQL é…ç½®
   - REST API é…ç½®
   - è®¤è¯æˆæƒ
   - CQRS å®ç°
   - äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰
     - äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰ï¼šåŸºäº RxJS Subject çš„å†…å­˜äº‹ä»¶æµ
     - å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼šæ”¯æŒè·¨æ¨¡å—äº‹ä»¶é€šä¿¡
     - äº‹ä»¶å¤„ç†å™¨ï¼šå¤„ç†ä¸šåŠ¡äº‹ä»¶
     - **æ³¨æ„**: äº‹ä»¶ä»…åœ¨å†…å­˜ä¸­æµè½¬ï¼Œæœªå®ç°äº‹ä»¶æŒä¹…åŒ–å­˜å‚¨
   - æ’ä»¶ç³»ç»Ÿ

3. **`packages/auth/`** - è®¤è¯æ¨¡å—
   - JWT è®¤è¯
   - ç­–ç•¥å®ç°
   - æƒé™ç®¡ç†

4. **`packages/common/`** - é€šç”¨å·¥å…·
   - è£…é¥°å™¨
   - æ‹¦æˆªå™¨
   - è¿‡æ»¤å™¨
   - ç®¡é“

5. **`packages/config/`** - é…ç½®ç®¡ç†
   - ç¯å¢ƒå˜é‡ç®¡ç†
   - é…ç½®éªŒè¯

6. **`packages/constants/`** - å¸¸é‡å®šä¹‰
   - ä¸šåŠ¡å¸¸é‡
   - æšä¸¾å®šä¹‰

7. **`packages/contracts/`** - æ¥å£å®šä¹‰
   - DTO å®šä¹‰
   - æ¥å£å¥‘çº¦

8. **`packages/utils/`** - å·¥å…·å‡½æ•°
   - é€šç”¨å·¥å…·å‡½æ•°

#### âŒ **å‰ç«¯ç›¸å…³ä»£ç ï¼ˆéœ€æ’é™¤ï¼‰**

1. **`apps/gauzy/`** - Angular å‰ç«¯åº”ç”¨
2. **`apps/desktop/`** - Electron æ¡Œé¢åº”ç”¨
3. **`apps/desktop-timer/`** - æ¡Œé¢è®¡æ—¶å™¨
4. **`packages/ui-*`** - æ‰€æœ‰ UI ç›¸å…³åŒ…
5. **`packages/desktop-*`** - æ¡Œé¢åº”ç”¨ç›¸å…³åŒ…

### 4.3 æŠ€æœ¯å¯è¡Œæ€§åˆ†æ

#### âœ… **é«˜åº¦å¯è¡Œ**

**ç†ç”±**ï¼š

1. **æ¶æ„æ¸…æ™°åˆ†ç¦»**
   - ever-gauzy é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„
   - åç«¯ä»£ç é›†ä¸­åœ¨ `apps/api` å’Œ `packages/core` ç­‰ç›®å½•
   - å‰åç«¯é€šè¿‡ REST API å’Œ GraphQL é€šä¿¡ï¼Œè€¦åˆåº¦ä½

2. **ä¾èµ–å…³ç³»æ¸…æ™°**
   - åç«¯åŒ…ä¸ä¾èµ–å‰ç«¯åŒ…
   - `@gauzy/core` æ˜¯çº¯åç«¯æ¡†æ¶
   - å‰ç«¯åŒ…ä¾èµ–åç«¯åŒ…ï¼Œä½†åå‘ä¸æˆç«‹

3. **æŠ€æœ¯æ ˆåŒ¹é…**
   - åç«¯ä½¿ç”¨ NestJS + TypeScriptï¼ˆä¸é¡¹ç›®ä¸€è‡´ï¼‰
   - æ•°æ®åº“æ”¯æŒï¼šPostgreSQLã€MongoDBã€Better-SQLiteï¼ˆä½¿ç”¨ MikroORM é€‚é…ï¼Œä¸é¡¹ç›®ä¸€è‡´ï¼‰
   - æ¶æ„æ¨¡å¼ï¼šåˆ†å±‚æ¶æ„ï¼ˆController-Service-Repositoryï¼‰+ CQRS + äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰ï¼ˆä¸é¡¹ç›®ä¸€è‡´ï¼‰
   - **æ¶æ„è¯´æ˜**ï¼š
     - ever-gauzy ä½¿ç”¨åˆ†å±‚æ¶æ„ï¼ŒæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼ˆå¦‚ userã€employeeã€organization ç­‰ï¼‰
     - ever-gauzy å®ç°äº† CQRS æ¨¡å¼ï¼Œä½¿ç”¨ `@nestjs/cqrs` çš„ Command å’Œ CommandHandler
     - ever-gauzy å®ç°äº†äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰ï¼ŒåŒ…å«äº‹ä»¶æ€»çº¿å’Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼
     - ever-gauzy **æœªå®ç°**å®Œæ•´çš„äº‹ä»¶æº¯æºï¼ˆESï¼‰ï¼Œäº‹ä»¶ä»…åœ¨å†…å­˜ä¸­æµè½¬
     - æœ¬é¡¹ç›®å¦‚éœ€è¦å®Œæ•´çš„äº‹ä»¶æº¯æºï¼Œéœ€è¦åœ¨æå–åè‡ªè¡Œå®ç°äº‹ä»¶å­˜å‚¨å’Œé‡æ”¾æœºåˆ¶

4. **æ’ä»¶ç³»ç»Ÿç‹¬ç«‹**
   - æ’ä»¶ç³»ç»Ÿè®¾è®¡ä¸ºåç«¯ç‹¬ç«‹è¿è¡Œ
   - æ’ä»¶é€šè¿‡ `plugin-config.ts` é…ç½®
   - å‰ç«¯æ’ä»¶ä¸åç«¯æ’ä»¶åˆ†ç¦»

### 4.4 æå–ç­–ç•¥

#### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¡†æ¶æå–

1. **æå– `packages/core/`**
   - æ ¸å¿ƒä¸šåŠ¡æ¡†æ¶
   - æ•°æ®åº“æ¨¡å—
   - GraphQL/REST é…ç½®
   - è®¤è¯æˆæƒ
   - CQRS å®ç°

2. **æå– `packages/auth/`**
   - JWT è®¤è¯
   - ç­–ç•¥å®ç°

3. **æå–åŸºç¡€åŒ…**
   - `packages/common/`
   - `packages/config/`
   - `packages/constants/`
   - `packages/contracts/`
   - `packages/utils/`

#### é˜¶æ®µäºŒï¼šAPI åº”ç”¨æå–

1. **æå– `apps/api/`**
   - ä¸»åº”ç”¨å…¥å£
   - æ’ä»¶é…ç½®
   - æ•°æ®åº“è¿ç§»
   - æ•°æ®ç§å­

#### é˜¶æ®µä¸‰ï¼šé€‚é…ä¸ä¼˜åŒ–

1. **ç§»é™¤å‰ç«¯ä¾èµ–**
   - æ¸…ç† `package.json` ä¸­çš„å‰ç«¯ä¾èµ–
   - ç§»é™¤ Angular ç›¸å…³é…ç½®

2. **ç®€åŒ– ORM å±‚**
   - **ç§»é™¤ TypeORM ç›¸å…³ä¾èµ–**ï¼šæ¸…ç† `package.json` ä¸­çš„ TypeORM ç›¸å…³ä¾èµ–ï¼ˆ`typeorm`ã€`@nestjs/typeorm`ã€`@nestjsx/crud-typeorm` ç­‰ï¼‰
   - **ç§»é™¤ TypeORM é…ç½®**ï¼šä» `plugin-config.ts` ä¸­ç§»é™¤ `dbTypeOrmConnectionConfig` ç›¸å…³é…ç½®
   - **ç§»é™¤ TypeORM æ¨¡å—**ï¼šä»åº”ç”¨æ¨¡å—ä¸­ç§»é™¤ `TypeOrmModule` çš„å¯¼å…¥å’Œé…ç½®
   - **ç§»é™¤ ORM æŠ½è±¡å±‚**ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼šåˆ é™¤å¤š ORM æ”¯æŒä»£ç ï¼Œç›´æ¥ä½¿ç”¨ MikroORM
   - **ä¿ç•™ç›®æ ‡æ•°æ®åº“æ”¯æŒ**ï¼šä¿ç•™ PostgreSQLã€MongoDBã€Better-SQLite ä¸‰ç§æ•°æ®åº“çš„ MikroORM æ”¯æŒ
     - ä¿ç•™ `@mikro-orm/postgresql`
     - ä¿ç•™ `@mikro-orm/mongodb`
     - ä¿ç•™ `@mikro-orm/better-sqlite`
   - **ç§»é™¤ MySQL æ”¯æŒ**ï¼šæ¸…ç† `package.json` ä¸­çš„ MySQL ç›¸å…³ä¾èµ–ï¼ˆ`@mikro-orm/mysql`ï¼‰å’Œé…ç½®
   - **ç¡®ä¿ä½¿ç”¨ MikroORM ä½œä¸ºå”¯ä¸€æ•°æ®è®¿é—®å±‚**ï¼šä½¿ç”¨ MikroORM é€‚é… PostgreSQLã€MongoDBã€Better-SQLite ä¸‰ç§æ•°æ®åº“

3. **äº‹ä»¶é©±åŠ¨æ¶æ„é€‚é…**
   - ä¿ç•™ ever-gauzy çš„äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰å®ç°
   - ä¿ç•™å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„äº‹ä»¶å¤„ç†æœºåˆ¶
   - **å¯é€‰**: å¦‚éœ€è¦å®Œæ•´çš„äº‹ä»¶æº¯æºï¼ˆESï¼‰ï¼Œéœ€è‡ªè¡Œå®ç°ï¼š
     - äº‹ä»¶å­˜å‚¨ï¼ˆEvent Storeï¼‰è¡¨ç»“æ„è®¾è®¡
     - äº‹ä»¶æŒä¹…åŒ–æœºåˆ¶
     - äº‹ä»¶é‡æ”¾å’ŒçŠ¶æ€é‡å»ºåŠŸèƒ½
     - èšåˆæ ¹å’Œäº‹ä»¶ç‰ˆæœ¬ç®¡ç†

4. **é€‚é… Turbo**
   - å°† Nx æ„å»ºè„šæœ¬è½¬æ¢ä¸º Turbo ä»»åŠ¡
   - é…ç½® Turbo ç¼“å­˜ç­–ç•¥

5. **ä»£ç é‡æ„**
   - æ ¹æ®é¡¹ç›®éœ€æ±‚è°ƒæ•´æ¶æ„
   - ä¼˜åŒ–ä»£ç ç»“æ„
   - æ·»åŠ ä¸­æ–‡æ³¨é‡Šï¼ˆTSDocï¼‰

### 4.5 æ½œåœ¨é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|----------|
| **ä»£ç è€¦åˆåº¦é«˜** | ä¸­ | ä»”ç»†åˆ†æä¾èµ–å…³ç³»ï¼Œé€æ­¥æå– |
| **é…ç½®å¤æ‚** | ä¸­ | ç®€åŒ–é…ç½®ï¼Œç§»é™¤å‰ç«¯ç›¸å…³é…ç½® |
| **ORM å±‚ç®€åŒ–** | ä¸­ | ç§»é™¤ TypeORM å’Œ ORM æŠ½è±¡å±‚ï¼Œä½¿ç”¨ MikroORM é€‚é… PostgreSQLã€MongoDBã€Better-SQLite |
| **æ’ä»¶ç³»ç»Ÿå¤æ‚** | ä½ | ä¿ç•™æ ¸å¿ƒæ’ä»¶ç³»ç»Ÿï¼Œç§»é™¤å‰ç«¯æ’ä»¶ |
| **æ•°æ®åº“è¿ç§»** | ä½ | ä¿ç•™ MikroORM è¿ç§»è„šæœ¬ï¼Œé€‚é…é¡¹ç›®æ•°æ®åº“ |
| **æµ‹è¯•è¦†ç›–ä¸è¶³** | ä¸­ | è¡¥å……å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯• |

### 4.6 å·¥ä½œé‡è¯„ä¼°

**é‡è¦æç¤º**ï¼šç”±äºå·¥ä½œé‡å·¨å¤§ï¼Œå¿…é¡»é‡‡ç”¨**åˆ†é˜¶æ®µã€æ¸è¿›å¼**å®æ–½ç­–ç•¥ã€‚æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿è´¨é‡åå†è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚

| é˜¶æ®µ | å·¥ä½œé‡ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|--------|------|--------|
| **ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å‡†å¤‡** | 3-5 å¤© | ä¾èµ–åˆ†æã€è§„åˆ’ã€åŸºç¡€ç»“æ„æ­å»º | ğŸ”´ é«˜ |
| **ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¡†æ¶æå–** | 5-8 å¤© | æå–æ ¸å¿ƒåŒ…ã€ç®€åŒ– ORMã€æ¸…ç†ä¾èµ– | ğŸ”´ é«˜ |
| **ç¬¬ä¸‰é˜¶æ®µï¼šAPI åº”ç”¨æå–** | 2-3 å¤© | æå–ä¸»åº”ç”¨ã€é…ç½®è¿ç§»ã€å¯åŠ¨æµ‹è¯• | ğŸ”´ é«˜ |
| **ç¬¬å››é˜¶æ®µï¼šåŠŸèƒ½æ¨¡å—æå–** | 3-5 å¤© | æå–ä¸šåŠ¡æ¨¡å—ï¼ˆå¯é€‰ï¼Œæ ¹æ®éœ€æ±‚ï¼‰ | ğŸŸ¡ ä¸­ |
| **ç¬¬äº”é˜¶æ®µï¼šä¼˜åŒ–ä¸æµ‹è¯•** | 5-6 å¤© | ä»£ç é‡æ„ã€æµ‹è¯•è¡¥å……ã€æ–‡æ¡£ç¼–å†™ | ğŸŸ¡ ä¸­ |
| **æ€»è®¡ï¼ˆä¸å«åŠŸèƒ½æ¨¡å—ï¼‰** | **15-22 å¤©** | çº¦ 3-4.5 å‘¨ | |
| **æ€»è®¡ï¼ˆå«åŠŸèƒ½æ¨¡å—ï¼‰** | **18-27 å¤©** | çº¦ 4-5 å‘¨ | |

**åˆ†é˜¶æ®µå®æ–½å»ºè®®**ï¼š
- âœ… **å¿…é¡»åˆ†é˜¶æ®µ**ï¼šæ¯ä¸ªé˜¶æ®µç‹¬ç«‹éªŒè¯ï¼Œé™ä½é£é™©
- âœ… **é˜¶æ®µé—´éªŒè¯**ï¼šæ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œå…¨é¢éªŒè¯
- âœ… **çµæ´»è°ƒæ•´**ï¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´åç»­é˜¶æ®µè®¡åˆ’
- âœ… **ä¼˜å…ˆçº§ç®¡ç†**ï¼šä¼˜å…ˆå®Œæˆæ ¸å¿ƒåŠŸèƒ½ï¼Œä¸šåŠ¡æ¨¡å—å¯æŒ‰éœ€æå–

---

## 5. ç»¼åˆè¯„ä¼°

### 5.1 å¯è¡Œæ€§ç»“è®º

| è¯„ä¼°é¡¹ | å¯è¡Œæ€§ | é£é™©ç­‰çº§ | å¤‡æ³¨ |
|--------|--------|----------|------|
| **Turbo æ›¿ä»£ Nx** | âœ… é«˜åº¦å¯è¡Œ | ğŸŸ¢ ä½é£é™© | é¡¹ç›®å·²é…ç½® Turbo |
| **åç«¯ä»£ç æå–** | âœ… é«˜åº¦å¯è¡Œ | ğŸŸ¡ ä¸­é£é™© | éœ€è¦ä»”ç»†åˆ†æä¾èµ– |
| **ç»¼åˆå®æ–½** | âœ… é«˜åº¦å¯è¡Œ | ğŸŸ¡ ä¸­é£é™© | å»ºè®®åˆ†é˜¶æ®µå®æ–½ |

### 5.2 ä¼˜åŠ¿åˆ†æ

1. **æŠ€æœ¯æ ˆç»Ÿä¸€**
   - ä½¿ç”¨ Turbo æ›¿ä»£ Nxï¼Œé™ä½å­¦ä¹ æˆæœ¬
   - ä¿æŒ NestJS + TypeScript æŠ€æœ¯æ ˆä¸€è‡´æ€§
   - ä¸“æ³¨äºåç«¯å¼€å‘ï¼Œæ— éœ€å…³æ³¨å‰ç«¯æŠ€æœ¯æ ˆ

2. **æ¶æ„æ¸…æ™°**
   - **çº¯åç«¯é¡¹ç›®**ï¼Œæ¶æ„æ›´ç®€æ´ï¼ŒèŒè´£å•ä¸€
   - ä¸åŒ…å«å‰ç«¯ä»£ç ï¼Œå‡å°‘ä»£ç åº“å¤æ‚åº¦
   - å‰åç«¯å®Œå…¨åˆ†ç¦»ï¼Œä¾¿äºç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
   - API æœåŠ¡å¯è¢«å¤šä¸ªå‰ç«¯åº”ç”¨æˆ–å…¶ä»–å®¢æˆ·ç«¯å¤ç”¨

3. **ç»´æŠ¤æˆæœ¬ä½**
   - Turbo é…ç½®æ›´ç®€å•ï¼Œæ— éœ€å‰ç«¯æ„å»ºé…ç½®
   - ä»£ç åº“æ›´å°ï¼Œä»…åŒ…å«åç«¯ä»£ç ï¼Œç»´æŠ¤æ›´å®¹æ˜“
   - æ— éœ€ç»´æŠ¤å‰ç«¯ä¾èµ–å’Œæ„å»ºæµç¨‹

4. **æ€§èƒ½ä¼˜åŒ–**
   - Turbo æ„å»ºé€Ÿåº¦æ›´å¿«
   - ç¼“å­˜æœºåˆ¶æ›´é«˜æ•ˆ
   - åç«¯æœåŠ¡å¯ç‹¬ç«‹ä¼˜åŒ–å’Œæ‰©å±•

### 5.3 æŒ‘æˆ˜åˆ†æ

1. **ä»£ç æå–å¤æ‚åº¦**
   - éœ€è¦ä»”ç»†åˆ†æä¾èµ–å…³ç³»
   - å¯èƒ½éœ€è¦é‡æ„éƒ¨åˆ†ä»£ç 

2. **é…ç½®è¿ç§»**
   - éœ€è¦å°† Nx é…ç½®è½¬æ¢ä¸º Turbo é…ç½®
   - éœ€è¦è°ƒæ•´æ„å»ºè„šæœ¬

3. **æµ‹è¯•è¦†ç›–**
   - éœ€è¦è¡¥å……æµ‹è¯•ç”¨ä¾‹
   - ç¡®ä¿ä»£ç è´¨é‡

---

## 6. å®æ–½å»ºè®®

### 6.1 å®æ–½åŸåˆ™

**æ ¸å¿ƒåŸåˆ™ï¼šåˆ†é˜¶æ®µã€æ¸è¿›å¼å®æ–½**

ç”±äºå·¥ä½œé‡å·¨å¤§ï¼ˆ18-27 å¤©ï¼‰ï¼Œå¿…é¡»é‡‡ç”¨åˆ†é˜¶æ®µå®æ–½ç­–ç•¥ï¼š

1. **æ¸è¿›å¼è¿ç§»ï¼ˆæ ¸å¿ƒåŸåˆ™ï¼‰**
   - **åˆ†é˜¶æ®µå®æ–½**ï¼šå°†å¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°é˜¶æ®µ
   - **é˜¶æ®µéªŒè¯**ï¼šæ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œå…¨é¢éªŒè¯
   - **é£é™©æ§åˆ¶**ï¼šæ¯ä¸ªé˜¶æ®µç‹¬ç«‹ï¼Œé™ä½æ•´ä½“é£é™©
   - **çµæ´»è°ƒæ•´**ï¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´åç»­é˜¶æ®µè®¡åˆ’

2. **ä¿æŒå…¼å®¹æ€§**
   - ä¿æŒ API æ¥å£å…¼å®¹
   - ç¡®ä¿æ•°æ®åº“è¿ç§»å¹³æ»‘
   - æ¸è¿›å¼æ›¿æ¢ï¼Œé¿å…å¤§çˆ†ç‚¸å¼å˜æ›´

3. **ä»£ç è´¨é‡ä¼˜å…ˆ**
   - éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
   - æ·»åŠ å®Œæ•´çš„ TSDoc æ³¨é‡Š
   - æ¯ä¸ªé˜¶æ®µç¡®ä¿ä»£ç è´¨é‡

4. **æµ‹è¯•é©±åŠ¨**
   - å…ˆç¼–å†™æµ‹è¯•ï¼Œå†æå–ä»£ç 
   - æ¯ä¸ªé˜¶æ®µè¡¥å……ç›¸åº”æµ‹è¯•
   - ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡

5. **å¯äº¤ä»˜æˆæœå¯¼å‘**
   - æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„äº¤ä»˜æˆæœ
   - æ¯ä¸ªé˜¶æ®µéƒ½æœ‰éªŒè¯æ ‡å‡†
   - ç¡®ä¿æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä»·å€¼äº§å‡º

### 6.2 åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

**é‡è¦è¯´æ˜**ï¼šç”±äºå·¥ä½œé‡å·¨å¤§ï¼ˆ18-27 å¤©ï¼Œçº¦ 4-5 å‘¨ï¼‰ï¼Œå¿…é¡»é‡‡ç”¨**åˆ†é˜¶æ®µã€æ¸è¿›å¼**çš„å®æ–½ç­–ç•¥ã€‚æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿è´¨é‡åå†è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚

#### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å‡†å¤‡ä¸è§„åˆ’ï¼ˆ1 å‘¨ï¼‰

**ç›®æ ‡**ï¼šå®Œæˆé¡¹ç›®å‡†å¤‡å’Œè¯¦ç»†è§„åˆ’

**ä»»åŠ¡æ¸…å•**ï¼š
1. âœ… ç¡®è®¤ Turbo é…ç½®ï¼ˆå·²å®Œæˆï¼‰
2. **æ·±å…¥åˆ†æ ever-gauzy ä¾èµ–å…³ç³»**
   - ç»˜åˆ¶ä¾èµ–å…³ç³»å›¾
   - è¯†åˆ«å…³é”®ä¾èµ–å’Œå¯é€‰ä¾èµ–
   - åˆ†æå‰åç«¯ä¾èµ–è¾¹ç•Œ
3. **åˆ¶å®šè¯¦ç»†çš„æå–è®¡åˆ’**
   - ç»†åŒ–æ¯ä¸ªåŒ…çš„æå–æ­¥éª¤
   - è¯†åˆ«æ½œåœ¨é£é™©å’Œåº”å¯¹æªæ–½
   - ç¡®å®šä¼˜å…ˆçº§å’Œä¾èµ–é¡ºåº
4. **æ­å»ºé¡¹ç›®åŸºç¡€ç»“æ„**
   - åˆ›å»º monorepo ç›®å½•ç»“æ„
   - é…ç½®åŸºç¡€åŒ…ï¼ˆlibs/coreã€libs/auth ç­‰ï¼‰
   - åˆå§‹åŒ– Turbo ä»»åŠ¡é…ç½®

**éªŒè¯æ ‡å‡†**ï¼š
- âœ… ä¾èµ–å…³ç³»å›¾æ¸…æ™°å®Œæ•´
- âœ… æå–è®¡åˆ’æ–‡æ¡£åŒ–
- âœ… é¡¹ç›®åŸºç¡€ç»“æ„å°±ç»ª

**å¯äº¤ä»˜æˆæœ**ï¼š
- ä¾èµ–å…³ç³»åˆ†ææ–‡æ¡£
- è¯¦ç»†æå–è®¡åˆ’æ–‡æ¡£
- é¡¹ç›®åŸºç¡€ç»“æ„ä»£ç 

---

##### ç¬¬ä¸€é˜¶æ®µæŠ€æœ¯æ–¹æ¡ˆï¼ˆPlanï¼‰

###### 1. ä¾èµ–å…³ç³»åˆ†ææ–¹æ³•è®º

**1.1 è‡ªåŠ¨åŒ–ä¾èµ–åˆ†æå·¥å…·**

ä½¿ç”¨ä»¥ä¸‹å·¥å…·å’Œæ–¹æ³•è¿›è¡Œä¾èµ–å…³ç³»åˆ†æï¼š

```bash
# 1. ä½¿ç”¨ pnpm åˆ†æä¾èµ–å…³ç³»
cd examples/ever-gauzy
pnpm list --depth=0 --json > dependency-tree.json

# 2. ä½¿ç”¨ madge ç”Ÿæˆä¾èµ–å…³ç³»å›¾
npx madge --extensions ts,js --circular packages/core/src packages/auth/src packages/common/src packages/config/src packages/constants/src packages/contracts/src packages/utils/src

# 3. åˆ†æ package.json ä¾èµ–
# æå–æ‰€æœ‰ packages/*/package.json ä¸­çš„ä¾èµ–å…³ç³»
find packages -name "package.json" -exec grep -l "dependencies\|devDependencies" {} \;
```

**1.2 ä¾èµ–åˆ†ç±»æ ‡å‡†**

å°†ä¾èµ–åˆ†ä¸ºä»¥ä¸‹ç±»åˆ«ï¼š

| ç±»åˆ« | è¯´æ˜ | å¤„ç†æ–¹å¼ |
|------|------|----------|
| **æ ¸å¿ƒåç«¯ä¾èµ–** | å¿…é¡»çš„åç«¯ä¾èµ–ï¼ˆ@nestjs/*ã€@mikro-orm/* ç­‰ï¼‰ | âœ… ä¿ç•™ |
| **å‰ç«¯ä¾èµ–** | Angularã€UI ç›¸å…³ï¼ˆ@angular/*ã€ui-* ç­‰ï¼‰ | âŒ ç§»é™¤ |
| **æ¡Œé¢åº”ç”¨ä¾èµ–** | Electronã€desktop-* ç›¸å…³ | âŒ ç§»é™¤ |
| **TypeORM ä¾èµ–** | typeormã€@nestjs/typeorm ç­‰ | âŒ ç§»é™¤ |
| **MySQL ä¾èµ–** | @mikro-orm/mysql | âŒ ç§»é™¤ |
| **ç›®æ ‡æ•°æ®åº“ä¾èµ–** | @mikro-orm/postgresqlã€@mikro-orm/mongodbã€@mikro-orm/better-sqlite | âœ… ä¿ç•™ |
| **å¯é€‰ä¾èµ–** | éæ ¸å¿ƒåŠŸèƒ½ä¾èµ–ï¼ˆæ’ä»¶ã€é›†æˆç­‰ï¼‰ | âš ï¸ æŒ‰éœ€ä¿ç•™ |

**1.3 ä¾èµ–å…³ç³»å›¾ç»˜åˆ¶**

ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ç»˜åˆ¶ä¾èµ–å…³ç³»å›¾ï¼š

1. **åŒ…çº§åˆ«ä¾èµ–å›¾**ï¼š
   ```bash
   # ä½¿ç”¨ pnpm ç”Ÿæˆä¾èµ–å›¾
   pnpm list --graph --depth=1
   
   # æˆ–ä½¿ç”¨ graphviz å¯è§†åŒ–
   pnpm list --json | jq -r '...' | dot -Tsvg > dependency-graph.svg
   ```

2. **ä»£ç çº§åˆ«ä¾èµ–å›¾**ï¼š
   ```bash
   # ä½¿ç”¨ madge ç”Ÿæˆä»£ç ä¾èµ–å›¾
   npx madge --image dependency-graph.svg packages/core/src
   ```

**1.4 å‰åç«¯ä¾èµ–è¾¹ç•Œåˆ†æ**

åˆ†ææ–¹æ³•ï¼š
1. **æ‰«æå¯¼å…¥è¯­å¥**ï¼š
   ```bash
   # æŸ¥æ‰¾æ‰€æœ‰ @gauzy/ui-* å’Œ @gauzy/desktop-* çš„å¯¼å…¥
   grep -r "@gauzy/ui-\|@gauzy/desktop-" packages/core packages/auth packages/common
   ```

2. **åˆ†æ package.json**ï¼š
   - æ£€æŸ¥æ¯ä¸ªåŒ…çš„ `dependencies` å’Œ `devDependencies`
   - è¯†åˆ«å¯¹å‰ç«¯åŒ…çš„ä¾èµ–
   - æ ‡è®°éœ€è¦ç§»é™¤çš„ä¾èµ–

3. **ä¾èµ–è¾¹ç•ŒéªŒè¯**ï¼š
   - ç¡®ä¿åç«¯åŒ…ä¸ä¾èµ–ä»»ä½• `ui-*` æˆ– `desktop-*` åŒ…
   - éªŒè¯å‰ç«¯åŒ…ä¾èµ–åç«¯åŒ…ï¼ˆåå‘ä¸æˆç«‹ï¼‰

---

###### 2. æå–è®¡åˆ’åˆ¶å®šæ–¹æ³•

**2.1 åŒ…æå–ä¼˜å…ˆçº§çŸ©é˜µ**

| ä¼˜å…ˆçº§ | åŒ…å | ä¾èµ–å…³ç³» | å·¥ä½œé‡ | é£é™© | è¯´æ˜ |
|--------|------|----------|--------|------|------|
| **P0ï¼ˆæœ€é«˜ï¼‰** | `packages/utils` | æ— ä¾èµ– | 1 å¤© | ä½ | åŸºç¡€å·¥å…·ï¼Œå…¶ä»–åŒ…ä¾èµ– |
| **P0** | `packages/constants` | æ— ä¾èµ– | 1 å¤© | ä½ | å¸¸é‡å®šä¹‰ï¼Œå…¶ä»–åŒ…ä¾èµ– |
| **P0** | `packages/contracts` | æ— ä¾èµ– | 1 å¤© | ä½ | æ¥å£å®šä¹‰ï¼Œå…¶ä»–åŒ…ä¾èµ– |
| **P1ï¼ˆé«˜ï¼‰** | `packages/common` | ä¾èµ– utilsã€constants | 2 å¤© | ä¸­ | é€šç”¨å·¥å…·ï¼Œæ ¸å¿ƒåŒ…ä¾èµ– |
| **P1** | `packages/config` | ä¾èµ– common | 2 å¤© | ä¸­ | é…ç½®ç®¡ç†ï¼Œæ ¸å¿ƒåŒ…ä¾èµ– |
| **P1** | `packages/auth` | ä¾èµ– coreã€common | 3 å¤© | ä¸­ | è®¤è¯æ¨¡å—ï¼Œç‹¬ç«‹åŠŸèƒ½ |
| **P2ï¼ˆä¸­ï¼‰** | `packages/core` | ä¾èµ–æ‰€æœ‰åŸºç¡€åŒ… | 5-7 å¤© | é«˜ | æ ¸å¿ƒæ¡†æ¶ï¼Œæœ€å¤æ‚ |
| **P2** | `apps/api` | ä¾èµ– coreã€auth | 2-3 å¤© | ä¸­ | ä¸»åº”ç”¨ï¼Œæœ€åæå– |

**2.2 æå–æ­¥éª¤ç»†åŒ–**

å¯¹æ¯ä¸ªåŒ…ï¼Œåˆ¶å®šä»¥ä¸‹æå–æ­¥éª¤ï¼š

1. **ä»£ç æå–**ï¼š
   - å¤åˆ¶æºä»£ç æ–‡ä»¶
   - ä¿ç•™ç›®å½•ç»“æ„
   - è®°å½•æ–‡ä»¶æ¸…å•

2. **ä¾èµ–æ¸…ç†**ï¼š
   - ç§»é™¤ TypeORM ä¾èµ–
   - ç§»é™¤å‰ç«¯ä¾èµ–
   - ç§»é™¤ MySQL ä¾èµ–
   - ä¿ç•™ç›®æ ‡æ•°æ®åº“ä¾èµ–

3. **å¯¼å…¥è·¯å¾„è°ƒæ•´**ï¼š
   - ä» `@gauzy/*` è°ƒæ•´ä¸º `@oksai/*`
   - è°ƒæ•´ç›¸å¯¹è·¯å¾„å¯¼å…¥
   - éªŒè¯å¯¼å…¥è·¯å¾„æ­£ç¡®æ€§

4. **é…ç½®é€‚é…**ï¼š
   - é€‚é… Turbo æ„å»ºé…ç½®
   - é€‚é… TypeScript é…ç½®
   - é€‚é…æµ‹è¯•é…ç½®

5. **éªŒè¯æµ‹è¯•**ï¼š
   - ç¼–è¯‘éªŒè¯
   - å•å…ƒæµ‹è¯•éªŒè¯
   - ä¾èµ–å…³ç³»éªŒè¯

**2.3 é£é™©è¯†åˆ«çŸ©é˜µ**

| é£é™©é¡¹ | å½±å“åŒ… | é£é™©ç­‰çº§ | åº”å¯¹æªæ–½ |
|--------|--------|----------|----------|
| **TypeORM ä»£ç è€¦åˆ** | core | ğŸ”´ é«˜ | ä»”ç»†åˆ†æï¼Œé€æ­¥æ›¿æ¢ä¸º MikroORM |
| **ORM æŠ½è±¡å±‚å¤æ‚** | core | ğŸŸ¡ ä¸­ | ç§»é™¤æŠ½è±¡å±‚ï¼Œç›´æ¥ä½¿ç”¨ MikroORM |
| **å‰åç«¯ä»£ç æ··åˆ** | coreã€auth | ğŸŸ¡ ä¸­ | ä»”ç»†æ£€æŸ¥ï¼Œç§»é™¤å‰ç«¯ç›¸å…³ä»£ç  |
| **æ’ä»¶ç³»ç»Ÿä¾èµ–** | coreã€api | ğŸŸ¡ ä¸­ | ä¿ç•™æ ¸å¿ƒæ’ä»¶ç³»ç»Ÿï¼Œç§»é™¤å‰ç«¯æ’ä»¶ |
| **æ•°æ®åº“è¿ç§»è„šæœ¬** | api | ğŸŸ¢ ä½ | é€‚é… MikroORM è¿ç§» |

---

###### 3. é¡¹ç›®åŸºç¡€ç»“æ„è®¾è®¡

**3.1 Monorepo ç›®å½•ç»“æ„**

```
oksai.api/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ api/                    # ä¸» API åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ main.ts
â”‚       â”‚   â”œâ”€â”€ app.module.ts
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ libs/                        # å…±äº«åº“ï¼ˆä» packages é‡å‘½åï¼‰
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒä¸šåŠ¡æ¡†æ¶ï¼ˆä» packages/core æå–ï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ lib/            # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                   # è®¤è¯æ¨¡å—ï¼ˆä» packages/auth æå–ï¼‰
â”‚   â”œâ”€â”€ common/                 # é€šç”¨å·¥å…·ï¼ˆä» packages/common æå–ï¼‰
â”‚   â”œâ”€â”€ config/                 # é…ç½®ç®¡ç†ï¼ˆä» packages/config æå–ï¼‰
â”‚   â”œâ”€â”€ constants/              # å¸¸é‡å®šä¹‰ï¼ˆä» packages/constants æå–ï¼‰
â”‚   â”œâ”€â”€ contracts/              # æ¥å£å¥‘çº¦ï¼ˆä» packages/contracts æå–ï¼‰
â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°ï¼ˆä» packages/utils æå–ï¼‰
â”‚
â”œâ”€â”€ tests/                       # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”‚
â”œâ”€â”€ examples/                    # å‚è€ƒé¡¹ç›®
â”‚   â””â”€â”€ ever-gauzy/
â”‚
â”œâ”€â”€ docs/                        # æ–‡æ¡£ç›®å½•
â”‚
â”œâ”€â”€ package.json                # æ ¹ package.json
â”œâ”€â”€ pnpm-workspace.yaml         # pnpm workspace é…ç½®
â”œâ”€â”€ turbo.json                  # Turbo é…ç½®
â””â”€â”€ tsconfig.json               # æ ¹ TypeScript é…ç½®
```

**3.2 åŒ…å‘½åè§„èŒƒ**

- **å‘½åç©ºé—´**ï¼šä» `@gauzy/*` æ”¹ä¸º `@oksai/*`
- **åŒ…åæ˜ å°„**ï¼š
  - `@gauzy/core` â†’ `@oksai/core`
  - `@gauzy/auth` â†’ `@oksai/auth`
  - `@gauzy/common` â†’ `@oksai/common`
  - `@gauzy/config` â†’ `@oksai/config`
  - `@gauzy/constants` â†’ `@oksai/constants`
  - `@gauzy/contracts` â†’ `@oksai/contracts`
  - `@gauzy/utils` â†’ `@oksai/utils`
  - `@gauzy/api` â†’ `@oksai/api`

**3.3 TypeScript é…ç½®ç»“æ„**

```json
// tsconfig.json (æ ¹é…ç½®)
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@oksai/core": ["libs/core/src"],
      "@oksai/auth": ["libs/auth/src"],
      "@oksai/common": ["libs/common/src"],
      "@oksai/config": ["libs/config/src"],
      "@oksai/constants": ["libs/constants/src"],
      "@oksai/contracts": ["libs/contracts/src"],
      "@oksai/utils": ["libs/utils/src"]
    }
  }
}
```

**3.4 Turbo ä»»åŠ¡é…ç½®**

åœ¨ `turbo.json` ä¸­é…ç½®ä»¥ä¸‹ä»»åŠ¡ï¼š

```json
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "test": {
      "dependsOn": ["build"],
      "outputs": ["coverage/**"]
    },
    "lint": {
      "outputs": []
    }
  }
}
```

---

###### 4. å…·ä½“æŠ€æœ¯å®æ–½æ­¥éª¤

**æ­¥éª¤ 4.1ï¼šä¾èµ–å…³ç³»åˆ†æï¼ˆ2 å¤©ï¼‰**

1. **è‡ªåŠ¨åŒ–åˆ†æè„šæœ¬**ï¼š
   ```bash
   # åˆ›å»ºåˆ†æè„šæœ¬
   scripts/analyze-dependencies.sh
   
   # æ‰§è¡Œåˆ†æ
   ./scripts/analyze-dependencies.sh
   ```

2. **ç”Ÿæˆä¾èµ–å…³ç³»æ–‡æ¡£**ï¼š
   - åŒ…çº§åˆ«ä¾èµ–å…³ç³»å›¾ï¼ˆSVG/PNGï¼‰
   - ä»£ç çº§åˆ«ä¾èµ–å…³ç³»å›¾
   - ä¾èµ–åˆ†ç±»æ¸…å•ï¼ˆExcel/CSVï¼‰
   - å‰åç«¯ä¾èµ–è¾¹ç•Œåˆ†ææŠ¥å‘Š

3. **éªŒè¯ä¾èµ–è¾¹ç•Œ**ï¼š
   - ç¡®è®¤åç«¯åŒ…æ— å‰ç«¯ä¾èµ–
   - ç¡®è®¤å‰ç«¯åŒ…ä¾èµ–åç«¯åŒ…ï¼ˆåå‘ä¸æˆç«‹ï¼‰

**æ­¥éª¤ 4.2ï¼šæå–è®¡åˆ’åˆ¶å®šï¼ˆ1 å¤©ï¼‰**

1. **åˆ›å»ºæå–è®¡åˆ’æ–‡æ¡£**ï¼š
   - åŒ…æå–ä¼˜å…ˆçº§çŸ©é˜µ
   - æ¯ä¸ªåŒ…çš„è¯¦ç»†æå–æ­¥éª¤
   - é£é™©è¯†åˆ«å’Œåº”å¯¹æªæ–½
   - ä¾èµ–é¡ºåºå›¾

2. **åˆ¶å®šæå–æ£€æŸ¥æ¸…å•**ï¼š
   - ä»£ç æå–æ£€æŸ¥é¡¹
   - ä¾èµ–æ¸…ç†æ£€æŸ¥é¡¹
   - é…ç½®é€‚é…æ£€æŸ¥é¡¹
   - éªŒè¯æµ‹è¯•æ£€æŸ¥é¡¹

**æ­¥éª¤ 4.3ï¼šé¡¹ç›®åŸºç¡€ç»“æ„æ­å»ºï¼ˆ2 å¤©ï¼‰**

1. **åˆ›å»ºç›®å½•ç»“æ„**ï¼š
   ```bash
   mkdir -p libs/{core,auth,common,config,constants,contracts,utils}/src
   ```

2. **åˆå§‹åŒ–åŸºç¡€åŒ…**ï¼š
   - ä¸ºæ¯ä¸ªåŒ…åˆ›å»º `package.json`
   - é…ç½® `tsconfig.json`
   - åˆ›å»º `src/index.ts` å…¥å£æ–‡ä»¶

3. **é…ç½® Turbo ä»»åŠ¡**ï¼š
   - æ›´æ–° `turbo.json`
   - é…ç½®æ„å»ºä»»åŠ¡
   - é…ç½®æµ‹è¯•ä»»åŠ¡

4. **é…ç½® TypeScript è·¯å¾„æ˜ å°„**ï¼š
   - æ›´æ–°æ ¹ `tsconfig.json`
   - é…ç½®è·¯å¾„åˆ«å

**æ­¥éª¤ 4.4ï¼šéªŒè¯å’Œæ–‡æ¡£åŒ–ï¼ˆ1 å¤©ï¼‰**

1. **éªŒè¯é¡¹ç›®ç»“æ„**ï¼š
   - éªŒè¯ç›®å½•ç»“æ„æ­£ç¡®
   - éªŒè¯ Turbo é…ç½®æ­£ç¡®
   - éªŒè¯ TypeScript é…ç½®æ­£ç¡®

2. **æ–‡æ¡£åŒ–**ï¼š
   - ä¾èµ–å…³ç³»åˆ†ææ–‡æ¡£
   - æå–è®¡åˆ’æ–‡æ¡£
   - é¡¹ç›®ç»“æ„è¯´æ˜æ–‡æ¡£

---

###### 5. å·¥å…·å’Œè„šæœ¬

**5.1 ä¾èµ–åˆ†æè„šæœ¬**

åˆ›å»º `scripts/analyze-dependencies.sh`ï¼š

```bash
#!/bin/bash
# åˆ†æ ever-gauzy ä¾èµ–å…³ç³»

cd examples/ever-gauzy

# 1. ç”Ÿæˆä¾èµ–æ ‘
echo "ç”Ÿæˆä¾èµ–æ ‘..."
pnpm list --depth=0 --json > ../../docs/dependency-tree.json

# 2. åˆ†æåç«¯åŒ…ä¾èµ–
echo "åˆ†æåç«¯åŒ…ä¾èµ–..."
for pkg in packages/core packages/auth packages/common packages/config packages/constants packages/contracts packages/utils; do
  echo "åˆ†æ $pkg..."
  cat $pkg/package.json | jq '.dependencies, .devDependencies' > ../../docs/deps-$pkg.json
done

# 3. æŸ¥æ‰¾å‰ç«¯ä¾èµ–
echo "æŸ¥æ‰¾å‰ç«¯ä¾èµ–..."
grep -r "@gauzy/ui-\|@gauzy/desktop-\|@angular" packages/core packages/auth packages/common > ../../docs/frontend-deps.txt || true
```

**5.2 é¡¹ç›®ç»“æ„åˆå§‹åŒ–è„šæœ¬**

åˆ›å»º `scripts/init-project-structure.sh`ï¼š

```bash
#!/bin/bash
# åˆå§‹åŒ–é¡¹ç›®åŸºç¡€ç»“æ„

# åˆ›å»º libs ç›®å½•ç»“æ„
mkdir -p libs/{core,auth,common,config,constants,contracts,utils}/src

# ä¸ºæ¯ä¸ªåŒ…åˆ›å»ºåŸºç¡€æ–‡ä»¶
for lib in core auth common config constants contracts utils; do
  # åˆ›å»º package.json
  cat > libs/$lib/package.json <<EOF
{
  "name": "@oksai/$lib",
  "version": "0.1.0",
  "private": true,
  "main": "./src/index.ts",
  "types": "./src/index.ts"
}
EOF

  # åˆ›å»º tsconfig.json
  cat > libs/$lib/tsconfig.json <<EOF
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist"
  },
  "include": ["src/**/*"]
}
EOF

  # åˆ›å»ºå…¥å£æ–‡ä»¶
  echo "export * from './lib';" > libs/$lib/src/index.ts
done
```

---

###### 6. éªŒè¯æ–¹æ³•

**6.1 ä¾èµ–å…³ç³»éªŒè¯**

```bash
# éªŒè¯åç«¯åŒ…æ— å‰ç«¯ä¾èµ–
grep -r "@gauzy/ui-\|@gauzy/desktop-\|@angular" libs/ && echo "âŒ å‘ç°å‰ç«¯ä¾èµ–" || echo "âœ… æ— å‰ç«¯ä¾èµ–"

# éªŒè¯ TypeORM ä¾èµ–å·²ç§»é™¤
grep -r "typeorm\|@nestjs/typeorm" libs/ && echo "âŒ å‘ç° TypeORM ä¾èµ–" || echo "âœ… TypeORM å·²ç§»é™¤"
```

**6.2 é¡¹ç›®ç»“æ„éªŒè¯**

```bash
# éªŒè¯ç›®å½•ç»“æ„
test -d libs/core/src && echo "âœ… core ç›®å½•å­˜åœ¨" || echo "âŒ core ç›®å½•ç¼ºå¤±"
test -d libs/auth/src && echo "âœ… auth ç›®å½•å­˜åœ¨" || echo "âŒ auth ç›®å½•ç¼ºå¤±"
# ... å…¶ä»–åŒ…éªŒè¯

# éªŒè¯ Turbo é…ç½®
turbo run build --dry-run && echo "âœ… Turbo é…ç½®æ­£ç¡®" || echo "âŒ Turbo é…ç½®é”™è¯¯"
```

**6.3 TypeScript é…ç½®éªŒè¯**

```bash
# éªŒè¯è·¯å¾„æ˜ å°„
tsc --showConfig | grep -A 10 "paths" && echo "âœ… è·¯å¾„æ˜ å°„é…ç½®æ­£ç¡®" || echo "âŒ è·¯å¾„æ˜ å°„é…ç½®é”™è¯¯"
```

---

#### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¡†æ¶æå–ï¼ˆ1-2 å‘¨ï¼‰

**ç›®æ ‡**ï¼šæå–å¹¶ç®€åŒ–æ ¸å¿ƒä¸šåŠ¡æ¡†æ¶

**ä»»åŠ¡æ¸…å•**ï¼š
1. **æå–åŸºç¡€åŒ…ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰**
   - `packages/common/` - é€šç”¨å·¥å…·
   - `packages/config/` - é…ç½®ç®¡ç†
   - `packages/constants/` - å¸¸é‡å®šä¹‰
   - `packages/contracts/` - æ¥å£å¥‘çº¦
   - `packages/utils/` - å·¥å…·å‡½æ•°
   - **éªŒè¯**ï¼šæ¯ä¸ªåŒ…å¯ç‹¬ç«‹æ„å»ºå’Œæµ‹è¯•

2. **æå–è®¤è¯æ¨¡å—**
   - `packages/auth/` - JWT è®¤è¯ã€ç­–ç•¥å®ç°
   - **éªŒè¯**ï¼šè®¤è¯åŠŸèƒ½å¯ç‹¬ç«‹æµ‹è¯•

3. **æå–æ ¸å¿ƒæ¡†æ¶ï¼ˆåˆ†æ­¥éª¤ï¼‰**
   - **æ­¥éª¤ 3.1**ï¼šæå– `packages/core/` çš„åŸºç¡€ç»“æ„
     - å®ä½“å®šä¹‰ï¼ˆBaseEntityã€TenantBaseEntity ç­‰ï¼‰
     - è¯·æ±‚ä¸Šä¸‹æ–‡ï¼ˆRequestContextï¼‰
     - CRUD åŸºç±»ï¼ˆCrudServiceã€TenantAwareCrudServiceï¼‰
   - **æ­¥éª¤ 3.2**ï¼šæå–æ•°æ®åº“æ¨¡å—
     - æ•°æ®åº“é…ç½®
     - Repository åŸºç±»
   - **æ­¥éª¤ 3.3**ï¼šæå– CQRS å’Œäº‹ä»¶æ€»çº¿
     - Command/Handler å®ç°
     - EventBus å®ç°
   - **æ­¥éª¤ 3.4**ï¼šæå– GraphQL/REST é…ç½®
   - **éªŒè¯**ï¼šæ¯ä¸ªæ­¥éª¤å®Œæˆåè¿›è¡Œå•å…ƒæµ‹è¯•

4. **ç®€åŒ– ORM å±‚ï¼ˆå…³é”®æ­¥éª¤ï¼‰**
   - ç§»é™¤ TypeORM ç›¸å…³ä¾èµ–å’Œé…ç½®
   - ç§»é™¤ ORM æŠ½è±¡å±‚ä»£ç 
   - ä¿ç•™ç›®æ ‡æ•°æ®åº“æ”¯æŒï¼šPostgreSQLã€MongoDBã€Better-SQLiteï¼ˆä½¿ç”¨ MikroORMï¼‰
   - ç§»é™¤ MySQL æ•°æ®åº“æ”¯æŒ
   - ç¡®ä¿ä½¿ç”¨ MikroORM ä½œä¸ºå”¯ä¸€æ•°æ®è®¿é—®å±‚
   - **éªŒè¯**ï¼šORM å±‚ç®€åŒ–ååŠŸèƒ½æ­£å¸¸ï¼Œä¸‰ç§æ•°æ®åº“é…ç½®å¯ç”¨

5. **æ¸…ç†å‰ç«¯ä¾èµ–**
   - æ¸…ç† `package.json` ä¸­çš„å‰ç«¯ä¾èµ–
   - ç§»é™¤ Angular ç›¸å…³é…ç½®
   - **éªŒè¯**ï¼šæ— å‰ç«¯ä¾èµ–æ®‹ç•™

6. **é…ç½® Turbo æ„å»ºä»»åŠ¡**
   - é…ç½®å„åŒ…çš„æ„å»ºä»»åŠ¡
   - é…ç½®æµ‹è¯•ä»»åŠ¡
   - é…ç½®ç¼“å­˜ç­–ç•¥
   - **éªŒè¯**ï¼šTurbo æ„å»ºæ­£å¸¸

**éªŒè¯æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰åŸºç¡€åŒ…å¯ç‹¬ç«‹æ„å»º
- âœ… æ ¸å¿ƒæ¡†æ¶æå–å®Œæˆ
- âœ… ORM å±‚å·²ç®€åŒ–ä¸ºä»… MikroORMï¼Œæ”¯æŒ PostgreSQLã€MongoDBã€Better-SQLite
- âœ… æ— å‰ç«¯ä¾èµ–
- âœ… Turbo æ„å»ºä»»åŠ¡é…ç½®å®Œæˆ

**å¯äº¤ä»˜æˆæœ**ï¼š
- æå–çš„åŸºç¡€åŒ…ä»£ç 
- ç®€åŒ–çš„æ ¸å¿ƒæ¡†æ¶ä»£ç 
- å•å…ƒæµ‹è¯•ç”¨ä¾‹

---

##### ç¬¬äºŒé˜¶æ®µæŠ€æœ¯æ–¹æ¡ˆï¼ˆPlanï¼‰

###### 1. åŸºç¡€åŒ…æå–æŠ€æœ¯æ–¹æ¡ˆ

**1.1 æå–é¡ºåºå’Œä¾èµ–å…³ç³»**

```
æå–é¡ºåºï¼ˆæŒ‰ä¾èµ–å…³ç³»ï¼‰ï¼š
1. packages/utils (æ— ä¾èµ–) â†’ libs/utils
2. packages/constants (æ— ä¾èµ–) â†’ libs/constants
3. packages/contracts (æ— ä¾èµ–) â†’ libs/contracts
4. packages/config (ä¾èµ– constants, contracts) â†’ libs/config
5. packages/common (ä¾èµ– constants, contracts, utils) â†’ libs/common
```

**1.2 æ¯ä¸ªåŸºç¡€åŒ…çš„æå–æ­¥éª¤**

**æ­¥éª¤æ¨¡æ¿ï¼ˆé€‚ç”¨äºæ‰€æœ‰åŸºç¡€åŒ…ï¼‰**ï¼š

```bash
# 1. åˆ›å»ºç›®æ ‡ç›®å½•
mkdir -p libs/{åŒ…å}/src

# 2. å¤åˆ¶æºä»£ç 
cp -r examples/ever-gauzy/packages/{åŒ…å}/src/* libs/{åŒ…å}/src/

# 3. åˆ›å»º package.json
# ä»æºåŒ…å¤åˆ¶å¹¶ä¿®æ”¹ï¼š
# - name: @gauzy/{åŒ…å} â†’ @oksai/{åŒ…å}
# - ç§»é™¤å‰ç«¯ä¾èµ–
# - ç§»é™¤ TypeORM ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰
# - ä¿ç•™ç›®æ ‡æ•°æ®åº“ä¾èµ–ï¼ˆPostgreSQLã€MongoDBã€Better-SQLiteï¼‰

# 4. åˆ›å»º tsconfig.json
# ç»§æ‰¿æ ¹é…ç½®ï¼Œè®¾ç½® outDir

# 5. æ›´æ–°å¯¼å…¥è·¯å¾„
# æ‰¹é‡æ›¿æ¢ï¼š@gauzy/* â†’ @oksai/*
find libs/{åŒ…å} -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 6. éªŒè¯ç¼–è¯‘
cd libs/{åŒ…å}
pnpm build
```

**1.3 å…·ä½“åŒ…çš„ç‰¹æ®Šå¤„ç†**

**packages/utils**ï¼š
- âœ… æœ€ç®€å•ï¼Œæ— å¤–éƒ¨ä¾èµ–
- âœ… ç›´æ¥å¤åˆ¶ï¼Œä»…éœ€ä¿®æ”¹å¯¼å…¥è·¯å¾„
- âš ï¸ æ£€æŸ¥æ˜¯å¦æœ‰å‰ç«¯ç›¸å…³å·¥å…·å‡½æ•°ï¼ˆå¦‚ DOM æ“ä½œï¼‰

**packages/constants**ï¼š
- âœ… ä»…å¸¸é‡å®šä¹‰ï¼Œæ— ä¾èµ–
- âœ… ç›´æ¥å¤åˆ¶ï¼Œä»…éœ€ä¿®æ”¹å¯¼å…¥è·¯å¾„
- âš ï¸ æ£€æŸ¥æ˜¯å¦æœ‰å‰ç«¯ç›¸å…³å¸¸é‡

**packages/contracts**ï¼š
- âœ… æ¥å£å’Œç±»å‹å®šä¹‰ï¼Œæ— ä¾èµ–
- âœ… ç›´æ¥å¤åˆ¶ï¼Œä»…éœ€ä¿®æ”¹å¯¼å…¥è·¯å¾„
- âš ï¸ æ£€æŸ¥æ˜¯å¦æœ‰å‰ç«¯ç›¸å…³æ¥å£

**packages/config**ï¼š
- âš ï¸ ä¾èµ– `@gauzy/constants`ã€`@gauzy/contracts`
- âš ï¸ éœ€è¦å…ˆæå– constants å’Œ contracts
- âš ï¸ æ£€æŸ¥é…ç½®é¡¹ï¼Œç§»é™¤å‰ç«¯ç›¸å…³é…ç½®

**packages/common**ï¼š
- âš ï¸ ä¾èµ–å¤šä¸ªåŒ…ï¼š`@gauzy/constants`ã€`@gauzy/contracts`ã€`@gauzy/utils`
- âš ï¸ åŒ…å« TypeORM ç›¸å…³ä»£ç ï¼ˆéœ€è¦ç§»é™¤ï¼‰
- âš ï¸ åŒ…å« GraphQL ç›¸å…³ä»£ç ï¼ˆéœ€è¦ä¿ç•™ï¼‰
- ğŸ”´ **å…³é”®**ï¼šéœ€è¦ç§»é™¤ `@nestjs/typeorm` å’Œ `typeorm` ä¾èµ–

**1.4 ä¾èµ–æ¸…ç†æ£€æŸ¥æ¸…å•**

å¯¹æ¯ä¸ªåŒ…ï¼Œæ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥å‰ç«¯ä¾èµ–
grep -r "@gauzy/ui-\|@gauzy/desktop-\|@angular" libs/{åŒ…å}/src/

# æ£€æŸ¥ TypeORM ä¾èµ–
grep -r "typeorm\|@nestjs/typeorm\|TypeOrmModule" libs/{åŒ…å}/src/

# æ£€æŸ¥ MySQL ä¾èµ–
grep -r "@mikro-orm/mysql" libs/{åŒ…å}/

# æ£€æŸ¥ package.json ä¾èµ–
cat libs/{åŒ…å}/package.json | jq '.dependencies, .devDependencies'
```

---

###### 2. è®¤è¯æ¨¡å—æå–æŠ€æœ¯æ–¹æ¡ˆ

**2.1 æå–æ­¥éª¤**

```bash
# 1. åˆ›å»ºç›®å½•
mkdir -p libs/auth/src

# 2. å¤åˆ¶æºä»£ç 
cp -r examples/ever-gauzy/packages/auth/src/* libs/auth/src/

# 3. åˆ›å»º package.json
# ä»æºåŒ…å¤åˆ¶å¹¶ä¿®æ”¹ï¼š
# - name: @gauzy/auth â†’ @oksai/auth
# - æ›´æ–°ä¾èµ–ï¼š@gauzy/* â†’ @oksai/*
# - ç§»é™¤å‰ç«¯ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰

# 4. æ›´æ–°å¯¼å…¥è·¯å¾„
find libs/auth -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 5. éªŒè¯ç¼–è¯‘
cd libs/auth
pnpm build
```

**2.2 è®¤è¯æ¨¡å—ä¾èµ–å…³ç³»**

```
libs/auth ä¾èµ–ï¼š
â”œâ”€â”€ @oksai/config (é…ç½®ç®¡ç†)
â”œâ”€â”€ @oksai/contracts (æ¥å£å®šä¹‰)
â””â”€â”€ @oksai/utils (å·¥å…·å‡½æ•°)
```

**2.3 ç‰¹æ®Šå¤„ç†é¡¹**

- âœ… ä¿ç•™æ‰€æœ‰è®¤è¯ç­–ç•¥ï¼ˆJWTã€OAuth2ã€Passport ç­‰ï¼‰
- âœ… ä¿ç•™è®¤è¯å®ˆå«å’Œè£…é¥°å™¨
- âš ï¸ æ£€æŸ¥æ˜¯å¦æœ‰å‰ç«¯ç›¸å…³çš„è®¤è¯é€»è¾‘ï¼ˆå¦‚ Cookie å¤„ç†ï¼‰
- âš ï¸ éªŒè¯ Redis ä¼šè¯å­˜å‚¨é…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

---

###### 3. æ ¸å¿ƒæ¡†æ¶æå–æŠ€æœ¯æ–¹æ¡ˆï¼ˆåˆ†æ­¥éª¤ï¼‰

**3.1 æ­¥éª¤ 3.1ï¼šæå–åŸºç¡€ç»“æ„**

**ç›®æ ‡**ï¼šæå–å®ä½“å®šä¹‰ã€è¯·æ±‚ä¸Šä¸‹æ–‡ã€CRUD åŸºç±»

**æå–å†…å®¹**ï¼š
```
packages/core/src/lib/core/
â”œâ”€â”€ entities/          # å®ä½“å®šä¹‰
â”‚   â”œâ”€â”€ base.entity.ts
â”‚   â”œâ”€â”€ tenant-base.entity.ts
â”‚   â”œâ”€â”€ tenant-organization-base.entity.ts
â”‚   â””â”€â”€ internal/      # å†…éƒ¨å®ä½“
â”œâ”€â”€ context/           # è¯·æ±‚ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ request-context.ts
â””â”€â”€ crud/              # CRUD åŸºç±»
    â”œâ”€â”€ crud.service.ts
    â”œâ”€â”€ tenant-aware-crud.service.ts
    â””â”€â”€ icrud.service.ts
```

**æå–æ­¥éª¤**ï¼š

```bash
# 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p libs/core/src/lib/core/{entities,context,crud}

# 2. å¤åˆ¶å®ä½“å®šä¹‰
cp -r examples/ever-gauzy/packages/core/src/lib/core/entities/* libs/core/src/lib/core/entities/

# 3. å¤åˆ¶è¯·æ±‚ä¸Šä¸‹æ–‡
cp -r examples/ever-gauzy/packages/core/src/lib/core/context/* libs/core/src/lib/core/context/

# 4. å¤åˆ¶ CRUD åŸºç±»
cp -r examples/ever-gauzy/packages/core/src/lib/core/crud/* libs/core/src/lib/core/crud/

# 5. æ›´æ–°å¯¼å…¥è·¯å¾„
find libs/core/src/lib/core -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 6. å¤„ç†å®ä½“ç»§æ‰¿å±‚æ¬¡
# ç¡®ä¿å®ä½“ç»§æ‰¿é“¾æ­£ç¡®ï¼š
# Model â†’ SoftDeletableBaseEntity â†’ AccessTimestamps â†’ BaseEntity â†’ TenantBaseEntity â†’ TenantOrganizationBaseEntity
```

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š

1. **å®ä½“è£…é¥°å™¨**ï¼š
   ```typescript
   // ç§»é™¤ TypeORM è£…é¥°å™¨ï¼Œä»…ä¿ç•™ MikroORM è£…é¥°å™¨
   // ä»ï¼š
   @PrimaryGeneratedColumn()
   @CreateDateColumn()
   @UpdateDateColumn()
   
   // æ”¹ä¸ºï¼š
   @PrimaryKey()
   @Property()
   ```

2. **å¤š ORM è£…é¥°å™¨å¤„ç†**ï¼š
   ```typescript
   // æ£€æŸ¥ MultiORMColumnã€MultiORMManyToOne ç­‰è£…é¥°å™¨
   // ç¡®ä¿ä»…ä½¿ç”¨ MikroORM ç‰ˆæœ¬
   ```

**3.2 æ­¥éª¤ 3.2ï¼šæå–æ•°æ®åº“æ¨¡å—**

**ç›®æ ‡**ï¼šæå–æ•°æ®åº“é…ç½®ã€Repository åŸºç±»ã€è¿ç§»å·¥å…·

**æå–å†…å®¹**ï¼š
```
packages/core/src/lib/
â”œâ”€â”€ database/          # æ•°æ®åº“æ¨¡å—
â”‚   â”œâ”€â”€ database.module.ts
â”‚   â”œâ”€â”€ connection-entity-manager.ts
â”‚   â”œâ”€â”€ migration.ts
â”‚   â””â”€â”€ migrations/    # è¿ç§»è„šæœ¬
â””â”€â”€ core/
    â”œâ”€â”€ repository/    # Repository åŸºç±»
    â”‚   â””â”€â”€ mikro-orm-base-entity.repository.ts
    â””â”€â”€ orm/           # ORM ç›¸å…³å·¥å…·
        â””â”€â”€ query-builder/
```

**æå–æ­¥éª¤**ï¼š

```bash
# 1. å¤åˆ¶æ•°æ®åº“æ¨¡å—
cp -r examples/ever-gauzy/packages/core/src/lib/database libs/core/src/lib/

# 2. å¤åˆ¶ Repository åŸºç±»
cp -r examples/ever-gauzy/packages/core/src/lib/core/repository libs/core/src/lib/core/

# 3. å¤åˆ¶ ORM å·¥å…·ï¼ˆæŸ¥è¯¢æ„å»ºå™¨ç­‰ï¼‰
cp -r examples/ever-gauzy/packages/core/src/lib/core/orm libs/core/src/lib/core/

# 4. æ›´æ–°å¯¼å…¥è·¯å¾„
find libs/core/src/lib/{database,core/repository,core/orm} -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;
```

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š

1. **ç§»é™¤ TypeORM è¿æ¥é…ç½®**ï¼š
   ```typescript
   // ä» database.module.ts ä¸­ç§»é™¤
   // TypeOrmModule.forRoot(...)
   ```

2. **ä»…ä¿ç•™ MikroORM é…ç½®**ï¼š
   ```typescript
   // ç¡®ä¿ä»…ä½¿ç”¨ MikroOrmModule
   MikroOrmModule.forRoot({
     // PostgreSQL é…ç½®
     // MongoDB é…ç½®
     // Better-SQLite é…ç½®
   })
   ```

3. **è¿ç§»è„šæœ¬é€‚é…**ï¼š
   ```typescript
   // ç¡®ä¿è¿ç§»è„šæœ¬ä»…ä½¿ç”¨ MikroORM
   // ç§»é™¤ TypeORM è¿ç§»ç›¸å…³ä»£ç 
   ```

**3.3 æ­¥éª¤ 3.3ï¼šæå– CQRS å’Œäº‹ä»¶æ€»çº¿**

**ç›®æ ‡**ï¼šæå– Command/Handler å®ç°ã€EventBus å®ç°

**æå–å†…å®¹**ï¼š
```
packages/core/src/lib/
â”œâ”€â”€ event-bus/         # äº‹ä»¶æ€»çº¿
â”‚   â”œâ”€â”€ event-bus.ts
â”‚   â”œâ”€â”€ base-event.ts
â”‚   â””â”€â”€ event-types.ts
â””â”€â”€ {æ¨¡å—å}/
    â””â”€â”€ commands/      # Command å’Œ Handler
        â”œâ”€â”€ {æ¨¡å—}.create.command.ts
        â””â”€â”€ handlers/
            â””â”€â”€ {æ¨¡å—}.create.handler.ts
```

**æå–æ­¥éª¤**ï¼š

```bash
# 1. å¤åˆ¶äº‹ä»¶æ€»çº¿
cp -r examples/ever-gauzy/packages/core/src/lib/event-bus libs/core/src/lib/

# 2. å¤åˆ¶ CQRS å®ç°ï¼ˆä»å„ä¸ªæ¨¡å—ï¼‰
# ä»¥ user æ¨¡å—ä¸ºä¾‹ï¼š
cp -r examples/ever-gauzy/packages/core/src/lib/user/commands libs/core/src/lib/user/

# 3. æ›´æ–°å¯¼å…¥è·¯å¾„
find libs/core/src/lib/event-bus -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;
```

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š

1. **äº‹ä»¶æ€»çº¿**ï¼š
   ```typescript
   // æ£€æŸ¥ EventBus å®ç°
   // ç¡®ä¿ä½¿ç”¨ RxJS Subjectï¼Œæ— å‰ç«¯ä¾èµ–
   ```

2. **Command/Handler**ï¼š
   ```typescript
   // ç¡®ä¿ Command å’Œ Handler å®ç°æ­£ç¡®
   // æ£€æŸ¥æ˜¯å¦æœ‰å‰ç«¯ç›¸å…³é€»è¾‘
   ```

**3.4 æ­¥éª¤ 3.4ï¼šæå– GraphQL/REST é…ç½®**

**ç›®æ ‡**ï¼šæå– GraphQL Schemaã€Resolverã€REST Controller

**æå–å†…å®¹**ï¼š
```
packages/core/src/lib/
â”œâ”€â”€ graphql/           # GraphQL é…ç½®
â”‚   â””â”€â”€ graphql.module.ts
â””â”€â”€ {æ¨¡å—å}/
    â”œâ”€â”€ {æ¨¡å—}.resolver.ts
    â””â”€â”€ {æ¨¡å—}.controller.ts
```

**æå–æ­¥éª¤**ï¼š

```bash
# 1. å¤åˆ¶ GraphQL é…ç½®
cp -r examples/ever-gauzy/packages/core/src/lib/graphql libs/core/src/lib/

# 2. å¤åˆ¶å„æ¨¡å—çš„ Resolver å’Œ Controller
# ä»¥ user æ¨¡å—ä¸ºä¾‹ï¼š
cp examples/ever-gauzy/packages/core/src/lib/user/*.resolver.ts libs/core/src/lib/user/ 2>/dev/null || true
cp examples/ever-gauzy/packages/core/src/lib/user/*.controller.ts libs/core/src/lib/user/ 2>/dev/null || true

# 3. æ›´æ–°å¯¼å…¥è·¯å¾„
find libs/core/src/lib/graphql -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;
```

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š

1. **GraphQL Schema**ï¼š
   ```typescript
   // ç¡®ä¿ Schema å®šä¹‰æ­£ç¡®
   // æ£€æŸ¥æ˜¯å¦æœ‰å‰ç«¯ç‰¹å®šçš„ç±»å‹
   ```

2. **Resolver/Controller**ï¼š
   ```typescript
   // ç¡®ä¿ä»…åŒ…å«åç«¯é€»è¾‘
   // ç§»é™¤å‰ç«¯ç‰¹å®šçš„è£…é¥°å™¨æˆ–é€»è¾‘
   ```

---

###### 4. ORM å±‚ç®€åŒ–æŠ€æœ¯æ–¹æ¡ˆï¼ˆå…³é”®æ­¥éª¤ï¼‰

**4.1 ç§»é™¤ TypeORM ä¾èµ–**

**æ­¥éª¤ 1ï¼šæ¸…ç† package.json**

```bash
# ä»æ‰€æœ‰åŒ…çš„ package.json ä¸­ç§»é™¤ TypeORM ä¾èµ–
find libs -name "package.json" -exec sed -i '/typeorm\|@nestjs\/typeorm\|@nestjsx\/crud-typeorm/d' {} \;
```

**æ­¥éª¤ 2ï¼šç§»é™¤ TypeORM å¯¼å…¥**

```bash
# æŸ¥æ‰¾æ‰€æœ‰ TypeORM å¯¼å…¥
find libs -type f -name "*.ts" -exec grep -l "from 'typeorm'\|from '@nestjs/typeorm'" {} \;

# æ‰¹é‡ç§»é™¤ TypeORM å¯¼å…¥å’Œä»£ç 
# éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶ï¼Œç¡®ä¿é€»è¾‘æ­£ç¡®
```

**æ­¥éª¤ 3ï¼šç§»é™¤ TypeORM è£…é¥°å™¨**

```typescript
// ä»å®ä½“ç±»ä¸­ç§»é™¤ TypeORM è£…é¥°å™¨
// ç¤ºä¾‹ï¼šbase.entity.ts

// ç§»é™¤ï¼š
import { PrimaryGeneratedColumn, CreateDateColumn, UpdateDateColumn, DeleteDateColumn } from 'typeorm';

// ä»…ä¿ç•™ MikroORM è£…é¥°å™¨ï¼š
import { PrimaryKey, Property } from '@mikro-orm/core';
```

**4.2 ç§»é™¤ ORM æŠ½è±¡å±‚**

**å…³é”®æ–‡ä»¶**ï¼š`libs/core/src/lib/core/utils.ts`

```typescript
// ä¿®æ”¹ getORMType å‡½æ•°
// ä»ï¼š
export function getORMType(): MultiORM {
  const dbType = process.env.DB_TYPE || 'postgres';
  // ... å¤æ‚çš„åˆ¤æ–­é€»è¾‘
}

// æ”¹ä¸ºï¼š
export function getORMType(): 'mikro-orm' {
  // ç›´æ¥è¿”å› MikroORMï¼Œç§»é™¤æ‰€æœ‰ TypeORM ç›¸å…³é€»è¾‘
  return 'mikro-orm';
}
```

**å…³é”®æ–‡ä»¶**ï¼š`libs/core/src/lib/core/crud/crud.service.ts`

```typescript
// ä¿®æ”¹ CrudService æ„é€ å‡½æ•°
// ä»ï¼š
constructor(
  protected readonly typeOrmRepository: Repository<T>,
  protected readonly mikroOrmRepository: MikroOrmBaseEntityRepository<T>
) {}

// æ”¹ä¸ºï¼š
constructor(
  protected readonly mikroOrmRepository: MikroOrmBaseEntityRepository<T>
) {}

// ç§»é™¤æ‰€æœ‰ typeOrmRepository çš„ä½¿ç”¨
// ä»…ä½¿ç”¨ mikroOrmRepository
```

**4.3 ç§»é™¤ MySQL æ”¯æŒ**

**æ­¥éª¤ 1ï¼šæ¸…ç† package.json**

```bash
# ä»æ‰€æœ‰åŒ…çš„ package.json ä¸­ç§»é™¤ MySQL ä¾èµ–
find libs -name "package.json" -exec sed -i '/@mikro-orm\/mysql/d' {} \;
```

**æ­¥éª¤ 2ï¼šç§»é™¤ MySQL é…ç½®**

```typescript
// ä»æ•°æ®åº“é…ç½®ä¸­ç§»é™¤ MySQL é€‰é¡¹
// ä»…ä¿ç•™ PostgreSQLã€MongoDBã€Better-SQLite
```

**4.4 ä¿ç•™ç›®æ ‡æ•°æ®åº“æ”¯æŒ**

**ç¡®ä¿ä»¥ä¸‹ä¾èµ–å­˜åœ¨**ï¼š

```json
{
  "dependencies": {
    "@mikro-orm/core": "^6.6.5",
    "@mikro-orm/nestjs": "^6.1.1",
    "@mikro-orm/postgresql": "^6.6.5",
    "@mikro-orm/mongodb": "^6.6.5",
    "@mikro-orm/better-sqlite": "^6.6.5"
  }
}
```

**4.5 ORM ç®€åŒ–éªŒè¯æ¸…å•**

```bash
# 1. éªŒè¯æ—  TypeORM ä¾èµ–
grep -r "typeorm\|@nestjs/typeorm" libs/ && echo "âŒ å‘ç° TypeORM ä¾èµ–" || echo "âœ… æ—  TypeORM ä¾èµ–"

# 2. éªŒè¯æ—  MySQL ä¾èµ–
grep -r "@mikro-orm/mysql" libs/ && echo "âŒ å‘ç° MySQL ä¾èµ–" || echo "âœ… æ—  MySQL ä¾èµ–"

# 3. éªŒè¯ç›®æ ‡æ•°æ®åº“ä¾èµ–å­˜åœ¨
grep -r "@mikro-orm/postgresql\|@mikro-orm/mongodb\|@mikro-orm/better-sqlite" libs/core/package.json && echo "âœ… ç›®æ ‡æ•°æ®åº“ä¾èµ–å­˜åœ¨" || echo "âŒ ç›®æ ‡æ•°æ®åº“ä¾èµ–ç¼ºå¤±"

# 4. éªŒè¯ CrudService ä»…ä½¿ç”¨ MikroORM
grep -A 5 "constructor" libs/core/src/lib/core/crud/crud.service.ts | grep "typeOrmRepository" && echo "âŒ ä»ä½¿ç”¨ TypeORM Repository" || echo "âœ… ä»…ä½¿ç”¨ MikroORM Repository"
```

---

###### 5. å‰ç«¯ä¾èµ–æ¸…ç†æŠ€æœ¯æ–¹æ¡ˆ

**5.1 æ¸…ç† package.json ä¾èµ–**

```bash
# æŸ¥æ‰¾æ‰€æœ‰å‰ç«¯ä¾èµ–
find libs -name "package.json" -exec grep -l "@gauzy/ui-\|@gauzy/desktop-\|@angular" {} \;

# ä» package.json ä¸­ç§»é™¤å‰ç«¯ä¾èµ–
# éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æ¯ä¸ªåŒ…ï¼Œç¡®ä¿ç§»é™¤æ­£ç¡®
```

**5.2 æ¸…ç†ä»£ç ä¸­çš„å‰ç«¯å¼•ç”¨**

```bash
# æŸ¥æ‰¾æ‰€æœ‰å‰ç«¯ç›¸å…³å¯¼å…¥
find libs -type f -name "*.ts" -exec grep -l "@gauzy/ui-\|@gauzy/desktop-\|@angular" {} \;

# æ£€æŸ¥æ˜¯å¦æœ‰å‰ç«¯ç›¸å…³ä»£ç 
# éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶ï¼Œç¡®ä¿ç§»é™¤æˆ–æ›¿æ¢æ­£ç¡®
```

**5.3 æ¸…ç† Angular é…ç½®**

```bash
# æŸ¥æ‰¾ Angular é…ç½®æ–‡ä»¶
find libs -name "angular.json\|ng-package.json" -delete

# æŸ¥æ‰¾ Nx é…ç½®æ–‡ä»¶
find libs -name "project.json\|nx.json" -delete
```

**5.4 å‰ç«¯ä¾èµ–æ¸…ç†éªŒè¯**

```bash
# éªŒè¯æ— å‰ç«¯ä¾èµ–
grep -r "@gauzy/ui-\|@gauzy/desktop-\|@angular" libs/ && echo "âŒ å‘ç°å‰ç«¯ä¾èµ–" || echo "âœ… æ— å‰ç«¯ä¾èµ–"

# éªŒè¯æ—  Angular é…ç½®
find libs -name "angular.json\|ng-package.json" && echo "âŒ å‘ç° Angular é…ç½®" || echo "âœ… æ—  Angular é…ç½®"
```

---

###### 6. Turbo æ„å»ºä»»åŠ¡é…ç½®

**6.1 æ›´æ–° turbo.json**

```json
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"],
      "inputs": [
        "src/**/*.ts",
        "tsconfig.json",
        "package.json"
      ]
    },
    "test": {
      "dependsOn": ["build"],
      "outputs": ["coverage/**"],
      "inputs": [
        "src/**/*.ts",
        "**/*.spec.ts",
        "tsconfig.json",
        "package.json"
      ]
    },
    "lint": {
      "outputs": [],
      "inputs": [
        "src/**/*.ts",
        "eslint.config.js"
      ]
    }
  }
}
```

**6.2 ä¸ºæ¯ä¸ªåŒ…é…ç½®æ„å»ºè„šæœ¬**

**libs/core/package.json**ï¼š

```json
{
  "name": "@oksai/core",
  "scripts": {
    "build": "nest build core",
    "test": "jest",
    "lint": "eslint src"
  }
}
```

**6.3 Turbo é…ç½®éªŒè¯**

```bash
# éªŒè¯ Turbo é…ç½®
turbo run build --dry-run && echo "âœ… Turbo é…ç½®æ­£ç¡®" || echo "âŒ Turbo é…ç½®é”™è¯¯"

# æµ‹è¯•æ„å»º
turbo run build

# æµ‹è¯•ç¼“å­˜
turbo run build --force
turbo run build  # åº”è¯¥ä½¿ç”¨ç¼“å­˜
```

---

###### 7. éªŒè¯å’Œæµ‹è¯•æ–¹æ¡ˆ

**7.1 ç¼–è¯‘éªŒè¯**

```bash
# ä¸ºæ¯ä¸ªåŒ…æ‰§è¡Œç¼–è¯‘éªŒè¯
for lib in utils constants contracts config common auth core; do
  echo "éªŒè¯ $lib..."
  cd libs/$lib
  pnpm build || echo "âŒ $lib ç¼–è¯‘å¤±è´¥"
  cd ../..
done
```

**7.2 å•å…ƒæµ‹è¯•éªŒè¯**

```bash
# ä¸ºæ¯ä¸ªåŒ…æ‰§è¡Œæµ‹è¯•
for lib in utils constants contracts config common auth core; do
  echo "æµ‹è¯• $lib..."
  cd libs/$lib
  pnpm test || echo "âŒ $lib æµ‹è¯•å¤±è´¥"
  cd ../..
done
```

**7.3 ä¾èµ–å…³ç³»éªŒè¯**

```bash
# éªŒè¯å¯¼å…¥è·¯å¾„
grep -r "@gauzy/" libs/ && echo "âŒ å‘ç°æ—§å¯¼å…¥è·¯å¾„" || echo "âœ… å¯¼å…¥è·¯å¾„æ­£ç¡®"

# éªŒè¯åŒ…ä¾èµ–
for lib in utils constants contracts config common auth core; do
  echo "æ£€æŸ¥ $lib ä¾èµ–..."
  cd libs/$lib
  pnpm list --depth=0
  cd ../..
done
```

**7.4 é›†æˆéªŒè¯**

```bash
# éªŒè¯æ‰€æœ‰åŒ…å¯ä»¥ä¸€èµ·æ„å»º
turbo run build

# éªŒè¯æµ‹è¯•å¯ä»¥ä¸€èµ·è¿è¡Œ
turbo run test
```

---

###### 8. è‡ªåŠ¨åŒ–è„šæœ¬

**8.1 æå–è„šæœ¬æ¨¡æ¿**

åˆ›å»º `scripts/extract-package.sh`ï¼š

```bash
#!/bin/bash
# æå–åŒ…çš„é€šç”¨è„šæœ¬

PACKAGE_NAME=$1
SOURCE_DIR="examples/ever-gauzy/packages/$PACKAGE_NAME"
TARGET_DIR="libs/$PACKAGE_NAME"

# 1. åˆ›å»ºç›®å½•
mkdir -p $TARGET_DIR/src

# 2. å¤åˆ¶æºä»£ç 
cp -r $SOURCE_DIR/src/* $TARGET_DIR/src/

# 3. å¤åˆ¶å¹¶ä¿®æ”¹ package.json
cp $SOURCE_DIR/package.json $TARGET_DIR/
sed -i 's/@gauzy\//@oksai\//g' $TARGET_DIR/package.json
sed -i 's/"name": "@gauzy\//"name": "@oksai\//g' $TARGET_DIR/package.json

# 4. åˆ›å»º tsconfig.json
cat > $TARGET_DIR/tsconfig.json <<EOF
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist"
  },
  "include": ["src/**/*"]
}
EOF

# 5. æ›´æ–°å¯¼å…¥è·¯å¾„
find $TARGET_DIR -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

echo "âœ… $PACKAGE_NAME æå–å®Œæˆ"
```

**8.2 ORM ç®€åŒ–è„šæœ¬**

åˆ›å»º `scripts/simplify-orm.sh`ï¼š

```bash
#!/bin/bash
# ORM ç®€åŒ–è„šæœ¬

# 1. ç§»é™¤ TypeORM ä¾èµ–
find libs -name "package.json" -exec sed -i '/typeorm\|@nestjs\/typeorm\|@nestjsx\/crud-typeorm/d' {} \;

# 2. ç§»é™¤ MySQL ä¾èµ–
find libs -name "package.json" -exec sed -i '/@mikro-orm\/mysql/d' {} \;

# 3. éªŒè¯
echo "æ£€æŸ¥ TypeORM ä¾èµ–..."
grep -r "typeorm\|@nestjs/typeorm" libs/ && echo "âŒ ä»æœ‰ TypeORM ä¾èµ–" || echo "âœ… TypeORM å·²ç§»é™¤"

echo "æ£€æŸ¥ MySQL ä¾èµ–..."
grep -r "@mikro-orm/mysql" libs/ && echo "âŒ ä»æœ‰ MySQL ä¾èµ–" || echo "âœ… MySQL å·²ç§»é™¤"
```

---

#### ç¬¬ä¸‰é˜¶æ®µï¼šAPI åº”ç”¨æå–ï¼ˆ1 å‘¨ï¼‰

**ç›®æ ‡**ï¼šæå–ä¸» API åº”ç”¨å¹¶å®ŒæˆåŸºç¡€é›†æˆ

**ä»»åŠ¡æ¸…å•**ï¼š
1. **æå– `apps/api/`**
   - ä¸»åº”ç”¨å…¥å£ï¼ˆmain.tsï¼‰
   - æ’ä»¶é…ç½®ï¼ˆplugin-config.tsï¼‰
   - Bootstrap æ¨¡å—
   - **éªŒè¯**ï¼šåº”ç”¨ç»“æ„å®Œæ•´

2. **é€‚é…é¡¹ç›®ç»“æ„**
   - è°ƒæ•´å¯¼å…¥è·¯å¾„
   - é€‚é… monorepo ç»“æ„
   - **éªŒè¯**ï¼šå¯¼å…¥è·¯å¾„æ­£ç¡®

3. **é…ç½®æ•°æ®åº“è¿ç§»**
   - æå–è¿ç§»è„šæœ¬
   - é€‚é… MikroORM è¿ç§»
   - **éªŒè¯**ï¼šè¿ç§»è„šæœ¬å¯æ‰§è¡Œ

4. **æµ‹è¯• API å¯åŠ¨**
   - é…ç½®æ•°æ®åº“è¿æ¥
   - æµ‹è¯•åº”ç”¨å¯åŠ¨
   - éªŒè¯åŸºç¡€åŠŸèƒ½
   - **éªŒè¯**ï¼šAPI å¯æ­£å¸¸å¯åŠ¨

**éªŒè¯æ ‡å‡†**ï¼š
- âœ… API åº”ç”¨ç»“æ„å®Œæ•´
- âœ… æ•°æ®åº“è¿ç§»æ­£å¸¸
- âœ… API å¯æ­£å¸¸å¯åŠ¨
- âœ… åŸºç¡€åŠŸèƒ½å¯ç”¨

**å¯äº¤ä»˜æˆæœ**ï¼š
- API åº”ç”¨ä»£ç 
- æ•°æ®åº“è¿ç§»è„šæœ¬
- å¯åŠ¨éªŒè¯æŠ¥å‘Š

---

##### ç¬¬ä¸‰é˜¶æ®µæŠ€æœ¯æ–¹æ¡ˆï¼ˆPlanï¼‰

###### 1. API åº”ç”¨æå–æŠ€æœ¯æ–¹æ¡ˆ

**1.1 æå–ç›®å½•ç»“æ„**

```
apps/api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts                    # ä¸»åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ load-env.ts               # ç¯å¢ƒå˜é‡åŠ è½½
â”‚   â”œâ”€â”€ plugin-config.ts          # æ’ä»¶é…ç½®ï¼ˆéœ€è¦ä¿®æ”¹ï¼‰
â”‚   â”œâ”€â”€ plugins.ts                # æ’ä»¶åˆ—è¡¨
â”‚   â”œâ”€â”€ migration.ts              # æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆéœ€è¦ä¿®æ”¹ï¼‰
â”‚   â”œâ”€â”€ seed.ts                   # æ•°æ®ç§å­è„šæœ¬
â”‚   â”œâ”€â”€ sentry.ts                 # Sentry é…ç½®
â”‚   â”œâ”€â”€ posthog.ts                # PostHog é…ç½®
â”‚   â””â”€â”€ assets/                   # é™æ€èµ„æº
â”œâ”€â”€ public/                        # å…¬å…±èµ„æº
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json                   # éœ€è¦ä¿®æ”¹
â”œâ”€â”€ tsconfig.json                  # TypeScript é…ç½®
â””â”€â”€ nest-cli.json                  # NestJS CLI é…ç½®
```

**1.2 æå–æ­¥éª¤**

```bash
# 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p apps/api/src/{assets,config}
mkdir -p apps/api/public

# 2. å¤åˆ¶æºä»£ç 
cp -r examples/ever-gauzy/apps/api/src/* apps/api/src/

# 3. å¤åˆ¶é…ç½®æ–‡ä»¶
cp -r examples/ever-gauzy/apps/api/config apps/api/ 2>/dev/null || true
cp -r examples/ever-gauzy/apps/api/public apps/api/ 2>/dev/null || true

# 4. å¤åˆ¶ TypeScript é…ç½®
cp examples/ever-gauzy/apps/api/tsconfig*.json apps/api/

# 5. åˆ›å»º package.jsonï¼ˆéœ€è¦ä¿®æ”¹ï¼‰
# ä»æºæ–‡ä»¶å¤åˆ¶å¹¶ä¿®æ”¹

# 6. æ›´æ–°å¯¼å…¥è·¯å¾„
find apps/api -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;
```

**1.3 ä¸»åº”ç”¨å…¥å£ï¼ˆmain.tsï¼‰ä¿®æ”¹**

**å…³é”®ä¿®æ”¹ç‚¹**ï¼š

```typescript
// ä¿®æ”¹å‰ï¼š
import { bootstrap } from '@gauzy/core';
import { pluginConfig } from './plugin-config';

// ä¿®æ”¹åï¼š
import { bootstrap } from '@oksai/core';
import { pluginConfig } from './plugin-config';

// å¯åŠ¨é€»è¾‘ä¿æŒä¸å˜
bootstrap(pluginConfig)
  .then(() => {
    console.timeEnd(chalk.green(`âœ” API Running`));
    console.timeEnd(chalk.green(`âœ” Total API Startup Time`));
  })
  .catch(async (error) => {
    console.log(error);
    process.exit(1);
  });
```

**1.4 ç¯å¢ƒå˜é‡åŠ è½½ï¼ˆload-env.tsï¼‰**

```typescript
// æ£€æŸ¥ load-env.ts å®ç°
// ç¡®ä¿ç¯å¢ƒå˜é‡åŠ è½½é€»è¾‘æ­£ç¡®
// é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚
```

---

###### 2. æ’ä»¶é…ç½®é€‚é…æŠ€æœ¯æ–¹æ¡ˆ

**2.1 æ’ä»¶é…ç½®ï¼ˆplugin-config.tsï¼‰å…³é”®ä¿®æ”¹**

**ä¿®æ”¹ç‚¹ 1ï¼šç§»é™¤ TypeORM é…ç½®**

```typescript
// ä¿®æ”¹å‰ï¼š
import {
  dbTypeOrmConnectionConfig,      // âŒ éœ€è¦ç§»é™¤
  dbMikroOrmConnectionConfig,     // âœ… ä¿ç•™
  dbKnexConnectionConfig,          // âš ï¸ æŒ‰éœ€ä¿ç•™
  environment
} from '@gauzy/config';

// ä¿®æ”¹åï¼š
import {
  dbMikroOrmConnectionConfig,      // âœ… ä»…ä¿ç•™ MikroORM
  environment
} from '@oksai/config';
```

**ä¿®æ”¹ç‚¹ 2ï¼šæ›´æ–°æ’ä»¶é…ç½®å¯¹è±¡**

```typescript
// ä¿®æ”¹å‰ï¼š
export const pluginConfig: ApplicationPluginConfig = {
  apiConfigOptions: {
    // ... API é…ç½®
  },
  dbConnectionOptions: {
    typeOrm: dbTypeOrmConnectionConfig,      // âŒ ç§»é™¤
    mikroOrm: dbMikroOrmConnectionConfig,    // âœ… ä¿ç•™
    knex: dbKnexConnectionConfig              // âš ï¸ æŒ‰éœ€ä¿ç•™
  },
  // ...
};

// ä¿®æ”¹åï¼š
export const pluginConfig: ApplicationPluginConfig = {
  apiConfigOptions: {
    // ... API é…ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
  },
  dbConnectionOptions: {
    mikroOrm: dbMikroOrmConnectionConfig,    // âœ… ä»…ä¿ç•™ MikroORM
    // ç§»é™¤ typeOrm å’Œ knexï¼ˆå¦‚æœä¸éœ€è¦ï¼‰
  },
  // ...
};
```

**ä¿®æ”¹ç‚¹ 3ï¼šæ›´æ–°å¯¼å…¥è·¯å¾„**

```typescript
// ä¿®æ”¹å‰ï¼š
import { ApplicationPluginConfig } from '@gauzy/common';
import { DEFAULT_API_PORT, ... } from '@gauzy/constants';
import { ... } from '@gauzy/config';

// ä¿®æ”¹åï¼š
import { ApplicationPluginConfig } from '@oksai/common';
import { DEFAULT_API_PORT, ... } from '@oksai/constants';
import { ... } from '@oksai/config';
```

**ä¿®æ”¹ç‚¹ 4ï¼šæ’ä»¶åˆ—è¡¨ï¼ˆplugins.tsï¼‰**

```typescript
// æ£€æŸ¥ plugins.ts
// ç§»é™¤å‰ç«¯ç›¸å…³æ’ä»¶
// ä¿ç•™åç«¯æ’ä»¶ï¼ˆå¦‚ Sentryã€PostHogã€é›†æˆæ’ä»¶ç­‰ï¼‰

// ä¿®æ”¹å‰ï¼š
import { ... } from '@gauzy/plugin-*';

// ä¿®æ”¹åï¼š
import { ... } from '@oksai/plugin-*';  // å¦‚æœæ’ä»¶ä¹Ÿéœ€è¦æå–
// æˆ–è€…æš‚æ—¶ä¿ç•™ @gauzy/plugin-*ï¼Œåç»­å†å¤„ç†
```

**2.2 æ’ä»¶é…ç½®éªŒè¯æ¸…å•**

```bash
# 1. éªŒè¯æ—  TypeORM é…ç½®
grep -r "dbTypeOrmConnectionConfig\|TypeOrmModule" apps/api/src/plugin-config.ts && echo "âŒ ä»æœ‰ TypeORM é…ç½®" || echo "âœ… TypeORM é…ç½®å·²ç§»é™¤"

# 2. éªŒè¯ MikroORM é…ç½®å­˜åœ¨
grep -r "dbMikroOrmConnectionConfig\|MikroOrmModule" apps/api/src/plugin-config.ts && echo "âœ… MikroORM é…ç½®å­˜åœ¨" || echo "âŒ MikroORM é…ç½®ç¼ºå¤±"

# 3. éªŒè¯å¯¼å…¥è·¯å¾„
grep -r "@gauzy/" apps/api/src/plugin-config.ts && echo "âŒ ä»æœ‰æ—§å¯¼å…¥è·¯å¾„" || echo "âœ… å¯¼å…¥è·¯å¾„æ­£ç¡®"
```

---

###### 3. Bootstrap æ¨¡å—é€‚é…æŠ€æœ¯æ–¹æ¡ˆ

**3.1 Bootstrap æ¨¡å—ä½ç½®**

Bootstrap æ¨¡å—ä½äº `@oksai/core` åŒ…ä¸­ï¼ˆå·²åœ¨ç¬¬äºŒé˜¶æ®µæå–ï¼‰ï¼š
- `libs/core/src/lib/bootstrap/bootstrap.ts`

**3.2 Bootstrap æ¨¡å—æ£€æŸ¥**

```typescript
// æ£€æŸ¥ bootstrap å‡½æ•°å®ç°
// ç¡®ä¿ï¼š
// 1. æ•°æ®åº“è¿æ¥ä½¿ç”¨ MikroORMï¼ˆæ—  TypeORMï¼‰
// 2. æ’ä»¶ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
// 3. GraphQL é…ç½®æ­£ç¡®
// 4. ä¸­é—´ä»¶é…ç½®æ­£ç¡®
```

**3.3 Bootstrap æ¨¡å—ä¾èµ–éªŒè¯**

```bash
# éªŒè¯ bootstrap æ¨¡å—çš„ä¾èµ–
cd libs/core
grep -r "typeorm\|@nestjs/typeorm" src/lib/bootstrap/ && echo "âŒ ä»æœ‰ TypeORM ä¾èµ–" || echo "âœ… æ—  TypeORM ä¾èµ–"

# éªŒè¯ MikroORM ä¾èµ–
grep -r "@mikro-orm" src/lib/bootstrap/ && echo "âœ… MikroORM ä¾èµ–å­˜åœ¨" || echo "âŒ MikroORM ä¾èµ–ç¼ºå¤±"
```

---

###### 4. æ•°æ®åº“è¿ç§»é€‚é…æŠ€æœ¯æ–¹æ¡ˆ

**4.1 è¿ç§»è„šæœ¬ï¼ˆmigration.tsï¼‰ä¿®æ”¹**

**ä¿®æ”¹å‰ï¼ˆever-gauzy ç‰ˆæœ¬ï¼‰**ï¼š

```typescript
// å¯èƒ½åŒ…å« TypeORM å’Œ MikroORM çš„æ··åˆè¿ç§»é€»è¾‘
import { ... } from 'typeorm';
import { ... } from '@mikro-orm/core';
```

**ä¿®æ”¹åï¼ˆä»… MikroORMï¼‰**ï¼š

```typescript
/**
 * æ•°æ®åº“è¿ç§»è„šæœ¬
 *
 * @description
 * ä½¿ç”¨ MikroORM è¿›è¡Œæ•°æ®åº“è¿ç§»ç®¡ç†ã€‚
 * æ”¯æŒ PostgreSQLã€MongoDBã€Better-SQLite ä¸‰ç§æ•°æ®åº“ã€‚
 *
 * @package @oksai/api
 */

import { MikroORM } from '@mikro-orm/core';
import { getMikroORMConfig } from '@oksai/config';
import * as yargs from 'yargs';

/**
 * è¿è¡Œè¿ç§»
 */
async function runMigrations() {
  const orm = await MikroORM.init(getMikroORMConfig());
  const migrator = orm.getMigrator();
  
  await migrator.up();
  await orm.close();
}

/**
 * å›æ»šè¿ç§»
 */
async function revertMigrations() {
  const orm = await MikroORM.init(getMikroORMConfig());
  const migrator = orm.getMigrator();
  
  await migrator.down();
  await orm.close();
}

/**
 * ç”Ÿæˆè¿ç§»
 */
async function generateMigration(name: string) {
  const orm = await MikroORM.init(getMikroORMConfig());
  const migrator = orm.getMigrator();
  
  await migrator.createMigration(name);
  await orm.close();
}

// å‘½ä»¤è¡Œå‚æ•°è§£æ
const argv = yargs
  .command('migration:run', 'è¿è¡Œè¿ç§»', {}, runMigrations)
  .command('migration:revert', 'å›æ»šè¿ç§»', {}, revertMigrations)
  .command('migration:generate', 'ç”Ÿæˆè¿ç§»', {
    name: { type: 'string', demandOption: true }
  }, (args) => generateMigration(args.name))
  .help()
  .argv;
```

**4.2 è¿ç§»è„šæœ¬æå–æ­¥éª¤**

```bash
# 1. å¤åˆ¶è¿ç§»è„šæœ¬
cp examples/ever-gauzy/apps/api/src/migration.ts apps/api/src/

# 2. ä¿®æ”¹è¿ç§»è„šæœ¬
# ç§»é™¤ TypeORM ç›¸å…³ä»£ç 
# ä»…ä¿ç•™ MikroORM è¿ç§»é€»è¾‘

# 3. æ›´æ–°å¯¼å…¥è·¯å¾„
sed -i 's/@gauzy\//@oksai\//g' apps/api/src/migration.ts

# 4. åˆ›å»ºè¿ç§»ç›®å½•
mkdir -p apps/api/src/migrations
```

**4.3 è¿ç§»è„šæœ¬é…ç½®**

**apps/api/package.json**ï¼š

```json
{
  "scripts": {
    "migration:up": "ts-node -r tsconfig-paths/register src/migration.ts migration:run",
    "migration:down": "ts-node -r tsconfig-paths/register src/migration.ts migration:revert",
    "migration:generate": "ts-node -r tsconfig-paths/register src/migration.ts migration:generate --name",
    "migration:create": "mikro-orm migration:create"
  }
}
```

**4.4 è¿ç§»è„šæœ¬éªŒè¯**

```bash
# 1. éªŒè¯è¿ç§»è„šæœ¬è¯­æ³•
cd apps/api
tsc --noEmit src/migration.ts && echo "âœ… è¿ç§»è„šæœ¬è¯­æ³•æ­£ç¡®" || echo "âŒ è¿ç§»è„šæœ¬è¯­æ³•é”™è¯¯"

# 2. éªŒè¯æ—  TypeORM ä¾èµ–
grep -r "typeorm\|@nestjs/typeorm" src/migration.ts && echo "âŒ ä»æœ‰ TypeORM ä¾èµ–" || echo "âœ… æ—  TypeORM ä¾èµ–"

# 3. æµ‹è¯•è¿ç§»å‘½ä»¤ï¼ˆéœ€è¦æ•°æ®åº“è¿æ¥ï¼‰
# pnpm migration:generate --name=InitialMigration
```

---

###### 5. é¡¹ç›®ç»“æ„é€‚é…æŠ€æœ¯æ–¹æ¡ˆ

**5.1 Monorepo ç»“æ„é€‚é…**

**è°ƒæ•´å¯¼å…¥è·¯å¾„**ï¼š

```bash
# æ‰¹é‡æ›´æ–°å¯¼å…¥è·¯å¾„
find apps/api -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# æ›´æ–°ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰
# æ£€æŸ¥æ˜¯å¦æœ‰ç›¸å¯¹è·¯å¾„å¯¼å…¥éœ€è¦è°ƒæ•´
```

**5.2 TypeScript é…ç½®é€‚é…**

**apps/api/tsconfig.json**ï¼š

```json
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "./src",
    "baseUrl": ".",
    "paths": {
      "@oksai/core": ["../../libs/core/src"],
      "@oksai/auth": ["../../libs/auth/src"],
      "@oksai/common": ["../../libs/common/src"],
      "@oksai/config": ["../../libs/config/src"],
      "@oksai/constants": ["../../libs/constants/src"],
      "@oksai/contracts": ["../../libs/contracts/src"],
      "@oksai/utils": ["../../libs/utils/src"]
    }
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

**5.3 NestJS CLI é…ç½®**

**apps/api/nest-cli.json**ï¼š

```json
{
  "$schema": "https://json.schemastore.org/nest-cli",
  "collection": "@nestjs/schematics",
  "sourceRoot": "src",
  "compilerOptions": {
    "deleteOutDir": true,
    "webpack": false,
    "tsConfigPath": "tsconfig.json"
  }
}
```

**5.4 Package.json é…ç½®**

**apps/api/package.json**ï¼š

```json
{
  "name": "@oksai/api",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "build": "nest build",
    "start:dev": "nest start --watch",
    "start:prod": "node dist/main.js",
    "migration:up": "ts-node -r tsconfig-paths/register src/migration.ts migration:run",
    "migration:down": "ts-node -r tsconfig-paths/register src/migration.ts migration:revert",
    "migration:generate": "ts-node -r tsconfig-paths/register src/migration.ts migration:generate",
    "test": "jest",
    "lint": "eslint src"
  },
  "dependencies": {
    "@oksai/core": "workspace:*",
    "@oksai/auth": "workspace:*",
    "@oksai/common": "workspace:*",
    "@oksai/config": "workspace:*",
    "@oksai/constants": "workspace:*",
    "@oksai/contracts": "workspace:*",
    "@oksai/utils": "workspace:*",
    // ... å…¶ä»–ä¾èµ–
  }
}
```

---

###### 6. API å¯åŠ¨æµ‹è¯•æŠ€æœ¯æ–¹æ¡ˆ

**6.1 ç¯å¢ƒå˜é‡é…ç½®**

**åˆ›å»º .env æ–‡ä»¶**ï¼š

```bash
# æ•°æ®åº“é…ç½®
DB_TYPE=postgresql  # æˆ– mongodbã€better-sqlite
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_DATABASE=oksai

# API é…ç½®
API_HOST=localhost
API_PORT=3000
API_BASE_URL=http://localhost:3000

# JWT é…ç½®
JWT_SECRET=your-secret-key
JWT_ACCESS_TOKEN_EXPIRES_IN=3600
JWT_REFRESH_TOKEN_EXPIRES_IN=86400

# å…¶ä»–é…ç½®...
```

**6.2 æ•°æ®åº“è¿æ¥æµ‹è¯•**

```bash
# 1. æµ‹è¯• PostgreSQL è¿æ¥
# ç¡®ä¿ PostgreSQL æœåŠ¡è¿è¡Œ
psql -h localhost -U postgres -d oksai -c "SELECT version();"

# 2. æµ‹è¯• MongoDB è¿æ¥ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
# mongosh mongodb://localhost:27017/oksai

# 3. æµ‹è¯• Better-SQLite è¿æ¥ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
# ç¡®ä¿æ•°æ®åº“æ–‡ä»¶è·¯å¾„æ­£ç¡®
```

**6.3 API å¯åŠ¨æµ‹è¯•æ­¥éª¤**

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. æ„å»ºæ‰€æœ‰åŒ…
turbo run build

# 3. è¿è¡Œæ•°æ®åº“è¿ç§»
cd apps/api
pnpm migration:up

# 4. å¯åŠ¨ APIï¼ˆå¼€å‘æ¨¡å¼ï¼‰
pnpm start:dev

# 5. éªŒè¯ API å¯åŠ¨
# æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºï¼š
# - âœ… Bootstrap Loaded
# - âœ… Plugin Config Loaded
# - âœ… API Running on http://localhost:3000
# - âœ… GraphQL Playground available at http://localhost:3000/graphql
```

**6.4 API åŠŸèƒ½éªŒè¯æ¸…å•**

**åŸºç¡€åŠŸèƒ½éªŒè¯**ï¼š

```bash
# 1. å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# 2. GraphQL ç«¯ç‚¹
curl -X POST http://localhost:3000/graphql \
  -H "Content-Type: application/json" \
  -d '{"query": "{ __schema { types { name } } }"}'

# 3. REST API ç«¯ç‚¹ï¼ˆå¦‚æœæœ‰ï¼‰
curl http://localhost:3000/api/users

# 4. æ•°æ®åº“è¿æ¥éªŒè¯
# æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰æ•°æ®åº“è¿æ¥æˆåŠŸçš„ä¿¡æ¯
```

**6.5 å¯åŠ¨é—®é¢˜æ’æŸ¥**

**å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**ï¼š

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| **æ•°æ®åº“è¿æ¥å¤±è´¥** | æ•°æ®åº“é…ç½®é”™è¯¯ | æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½® |
| **æ¨¡å—æœªæ‰¾åˆ°** | å¯¼å…¥è·¯å¾„é”™è¯¯ | æ£€æŸ¥ tsconfig.json ä¸­çš„ paths é…ç½® |
| **TypeORM ç›¸å…³é”™è¯¯** | ä»æœ‰ TypeORM ä»£ç  | æ£€æŸ¥å¹¶ç§»é™¤æ‰€æœ‰ TypeORM ç›¸å…³ä»£ç  |
| **æ’ä»¶åŠ è½½å¤±è´¥** | æ’ä»¶é…ç½®é”™è¯¯ | æ£€æŸ¥ plugin-config.ts ä¸­çš„æ’ä»¶é…ç½® |
| **ç«¯å£è¢«å ç”¨** | ç«¯å£å†²çª | æ›´æ”¹ API_PORT ç¯å¢ƒå˜é‡ |

---

###### 7. éªŒè¯å’Œæµ‹è¯•æ–¹æ¡ˆ

**7.1 ç¼–è¯‘éªŒè¯**

```bash
# éªŒè¯ API åº”ç”¨å¯ä»¥ç¼–è¯‘
cd apps/api
pnpm build && echo "âœ… API ç¼–è¯‘æˆåŠŸ" || echo "âŒ API ç¼–è¯‘å¤±è´¥"
```

**7.2 å¯¼å…¥è·¯å¾„éªŒè¯**

```bash
# éªŒè¯æ‰€æœ‰å¯¼å…¥è·¯å¾„æ­£ç¡®
grep -r "@gauzy/" apps/api/src/ && echo "âŒ ä»æœ‰æ—§å¯¼å…¥è·¯å¾„" || echo "âœ… å¯¼å…¥è·¯å¾„æ­£ç¡®"

# éªŒè¯æ–°å¯¼å…¥è·¯å¾„å­˜åœ¨
grep -r "@oksai/" apps/api/src/ | head -5 && echo "âœ… æ–°å¯¼å…¥è·¯å¾„å­˜åœ¨" || echo "âŒ æ–°å¯¼å…¥è·¯å¾„ç¼ºå¤±"
```

**7.3 ä¾èµ–å…³ç³»éªŒè¯**

```bash
# éªŒè¯ package.json ä¾èµ–
cd apps/api
pnpm list --depth=0

# éªŒè¯æ—  TypeORM ä¾èµ–
grep -r "typeorm\|@nestjs/typeorm" package.json && echo "âŒ ä»æœ‰ TypeORM ä¾èµ–" || echo "âœ… æ—  TypeORM ä¾èµ–"
```

**7.4 æ•°æ®åº“è¿ç§»éªŒè¯**

```bash
# éªŒè¯è¿ç§»è„šæœ¬å¯æ‰§è¡Œ
cd apps/api
ts-node -r tsconfig-paths/register src/migration.ts --help && echo "âœ… è¿ç§»è„šæœ¬å¯æ‰§è¡Œ" || echo "âŒ è¿ç§»è„šæœ¬ä¸å¯æ‰§è¡Œ"

# æµ‹è¯•ç”Ÿæˆè¿ç§»ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
# pnpm migration:generate --name=TestMigration
```

**7.5 API å¯åŠ¨éªŒè¯**

```bash
# å¯åŠ¨ API å¹¶æ£€æŸ¥è¾“å‡º
cd apps/api
timeout 30 pnpm start:dev 2>&1 | grep -E "API Running|Bootstrap|Error" && echo "âœ… API å¯åŠ¨æ£€æŸ¥å®Œæˆ" || echo "âš ï¸ éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥"
```

---

###### 8. è‡ªåŠ¨åŒ–è„šæœ¬

**8.1 API åº”ç”¨æå–è„šæœ¬**

åˆ›å»º `scripts/extract-api-app.sh`ï¼š

```bash
#!/bin/bash
# æå– API åº”ç”¨çš„è„šæœ¬

SOURCE_DIR="examples/ever-gauzy/apps/api"
TARGET_DIR="apps/api"

echo "å¼€å§‹æå– API åº”ç”¨..."

# 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p $TARGET_DIR/src/{assets,config}
mkdir -p $TARGET_DIR/public

# 2. å¤åˆ¶æºä»£ç 
echo "å¤åˆ¶æºä»£ç ..."
cp -r $SOURCE_DIR/src/* $TARGET_DIR/src/

# 3. å¤åˆ¶é…ç½®æ–‡ä»¶
echo "å¤åˆ¶é…ç½®æ–‡ä»¶..."
cp -r $SOURCE_DIR/config $TARGET_DIR/ 2>/dev/null || true
cp -r $SOURCE_DIR/public $TARGET_DIR/ 2>/dev/null || true
cp $SOURCE_DIR/tsconfig*.json $TARGET_DIR/

# 4. æ›´æ–°å¯¼å…¥è·¯å¾„
echo "æ›´æ–°å¯¼å…¥è·¯å¾„..."
find $TARGET_DIR -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 5. åˆ›å»º package.jsonï¼ˆéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ï¼‰
echo "åˆ›å»º package.json..."
cp $SOURCE_DIR/package.json $TARGET_DIR/package.json.template
echo "âš ï¸  è¯·æ‰‹åŠ¨ä¿®æ”¹ $TARGET_DIR/package.json.template ä¸º $TARGET_DIR/package.json"

# 6. åˆ›å»º nest-cli.json
cat > $TARGET_DIR/nest-cli.json <<EOF
{
  "\$schema": "https://json.schemastore.org/nest-cli",
  "collection": "@nestjs/schematics",
  "sourceRoot": "src",
  "compilerOptions": {
    "deleteOutDir": true,
    "webpack": false,
    "tsConfigPath": "tsconfig.json"
  }
}
EOF

echo "âœ… API åº”ç”¨æå–å®Œæˆ"
echo "âš ï¸  è¯·æ£€æŸ¥å¹¶ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š"
echo "   - $TARGET_DIR/package.json"
echo "   - $TARGET_DIR/src/plugin-config.ts"
echo "   - $TARGET_DIR/src/migration.ts"
```

**8.2 æ’ä»¶é…ç½®æ¸…ç†è„šæœ¬**

åˆ›å»º `scripts/clean-plugin-config.sh`ï¼š

```bash
#!/bin/bash
# æ¸…ç†æ’ä»¶é…ç½®ä¸­çš„ TypeORM ç›¸å…³ä»£ç 

CONFIG_FILE="apps/api/src/plugin-config.ts"

echo "æ¸…ç†æ’ä»¶é…ç½®..."

# 1. ç§»é™¤ TypeORM å¯¼å…¥
sed -i '/dbTypeOrmConnectionConfig/d' $CONFIG_FILE
sed -i '/TypeOrmModule/d' $CONFIG_FILE

# 2. ç§»é™¤ TypeORM é…ç½®å¯¹è±¡
sed -i '/typeOrm:/d' $CONFIG_FILE

# 3. éªŒè¯
grep -r "typeorm\|TypeORM" $CONFIG_FILE && echo "âŒ ä»æœ‰ TypeORM ä»£ç " || echo "âœ… TypeORM å·²æ¸…ç†"

echo "âœ… æ’ä»¶é…ç½®æ¸…ç†å®Œæˆ"
```

**8.3 è¿ç§»è„šæœ¬é€‚é…è„šæœ¬**

åˆ›å»º `scripts/adapt-migration.sh`ï¼š

```bash
#!/bin/bash
# é€‚é…è¿ç§»è„šæœ¬

MIGRATION_FILE="apps/api/src/migration.ts"

echo "é€‚é…è¿ç§»è„šæœ¬..."

# 1. å¤‡ä»½åŸæ–‡ä»¶
cp $MIGRATION_FILE $MIGRATION_FILE.backup

# 2. ç§»é™¤ TypeORM å¯¼å…¥
sed -i '/from.*typeorm/d' $MIGRATION_FILE
sed -i '/from.*@nestjs\/typeorm/d' $MIGRATION_FILE

# 3. éªŒè¯
grep -r "typeorm\|TypeORM" $MIGRATION_FILE && echo "âŒ ä»æœ‰ TypeORM ä»£ç " || echo "âœ… TypeORM å·²ç§»é™¤"

echo "âœ… è¿ç§»è„šæœ¬é€‚é…å®Œæˆ"
echo "âš ï¸  è¯·æ‰‹åŠ¨æ£€æŸ¥ $MIGRATION_FILE å¹¶å®Œå–„ MikroORM è¿ç§»é€»è¾‘"
```

---

###### 9. å¯åŠ¨éªŒè¯æŠ¥å‘Šæ¨¡æ¿

**åˆ›å»ºå¯åŠ¨éªŒè¯æŠ¥å‘Š**ï¼š

```markdown
# API åº”ç”¨å¯åŠ¨éªŒè¯æŠ¥å‘Š

## åŸºæœ¬ä¿¡æ¯
- **æ—¥æœŸ**: YYYY-MM-DD
- **ç¯å¢ƒ**: å¼€å‘/ç”Ÿäº§
- **æ•°æ®åº“ç±»å‹**: PostgreSQL/MongoDB/Better-SQLite

## éªŒè¯é¡¹ç›®

### 1. ç¼–è¯‘éªŒè¯
- [ ] API åº”ç”¨ç¼–è¯‘æˆåŠŸ
- [ ] æ‰€æœ‰ä¾èµ–åŒ…ç¼–è¯‘æˆåŠŸ
- [ ] æ— ç¼–è¯‘é”™è¯¯

### 2. é…ç½®éªŒè¯
- [ ] ç¯å¢ƒå˜é‡åŠ è½½æ­£ç¡®
- [ ] æ•°æ®åº“é…ç½®æ­£ç¡®
- [ ] æ’ä»¶é…ç½®æ­£ç¡®
- [ ] æ—  TypeORM é…ç½®æ®‹ç•™

### 3. æ•°æ®åº“éªŒè¯
- [ ] æ•°æ®åº“è¿æ¥æˆåŠŸ
- [ ] è¿ç§»è„šæœ¬å¯æ‰§è¡Œ
- [ ] è¿ç§»æ‰§è¡ŒæˆåŠŸ

### 4. API å¯åŠ¨éªŒè¯
- [ ] API å¯åŠ¨æˆåŠŸ
- [ ] ç«¯å£ç›‘å¬æ­£å¸¸
- [ ] GraphQL ç«¯ç‚¹å¯ç”¨
- [ ] REST API ç«¯ç‚¹å¯ç”¨ï¼ˆå¦‚æœæœ‰ï¼‰

### 5. åŠŸèƒ½éªŒè¯
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸
- [ ] è®¤è¯åŠŸèƒ½æ­£å¸¸
- [ ] åŸºç¡€ CRUD åŠŸèƒ½æ­£å¸¸

## é—®é¢˜è®°å½•
1. [é—®é¢˜æè¿°]
   - åŸå› ï¼š[åŸå› åˆ†æ]
   - è§£å†³æ–¹æ¡ˆï¼š[è§£å†³æ–¹æ¡ˆ]

## ç»“è®º
- [ ] æ‰€æœ‰éªŒè¯é¡¹ç›®é€šè¿‡
- [ ] API åº”ç”¨å¯ä»¥æ­£å¸¸ä½¿ç”¨
```

---

#### ç¬¬å››é˜¶æ®µï¼šåŠŸèƒ½æ¨¡å—æå–ï¼ˆ1-2 å‘¨ï¼Œå¯é€‰ï¼‰

**ç›®æ ‡**ï¼šæå–ä¸šåŠ¡åŠŸèƒ½æ¨¡å—ï¼ˆæ ¹æ®é¡¹ç›®éœ€æ±‚ï¼‰

**è¯´æ˜**ï¼šæ­¤é˜¶æ®µä¸ºå¯é€‰é˜¶æ®µï¼Œæ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚å†³å®šæå–å“ªäº›åŠŸèƒ½æ¨¡å—ã€‚

**ä»»åŠ¡æ¸…å•**ï¼š
1. **æå–ç”¨æˆ·æ¨¡å—**ï¼ˆå¦‚éœ€è¦ï¼‰
   - `packages/core/src/lib/user/`
   - éªŒè¯ç”¨æˆ· CRUD åŠŸèƒ½

2. **æå–å…¶ä»–ä¸šåŠ¡æ¨¡å—**ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
   - ç»„ç»‡æ¨¡å—ï¼ˆorganizationï¼‰
   - å‘˜å·¥æ¨¡å—ï¼ˆemployeeï¼‰
   - ä»»åŠ¡æ¨¡å—ï¼ˆtasksï¼‰
   - å…¶ä»–ä¸šåŠ¡æ¨¡å—
   - **éªŒè¯**ï¼šæ¯ä¸ªæ¨¡å—åŠŸèƒ½æ­£å¸¸

**éªŒè¯æ ‡å‡†**ï¼š
- âœ… æå–çš„æ¨¡å—åŠŸèƒ½å®Œæ•´
- âœ… æ¨¡å—é—´ä¾èµ–å…³ç³»æ¸…æ™°
- âœ… æ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•

**å¯äº¤ä»˜æˆæœ**ï¼š
- ä¸šåŠ¡æ¨¡å—ä»£ç 
- æ¨¡å—æµ‹è¯•ç”¨ä¾‹

---

##### ç¬¬å››é˜¶æ®µæŠ€æœ¯æ–¹æ¡ˆï¼ˆPlanï¼‰

###### 1. åŠŸèƒ½æ¨¡å—æå–é€šç”¨æ–¹æ¡ˆ

**1.1 æ¨¡å—ç»“æ„åˆ†æ**

æ¯ä¸ªåŠŸèƒ½æ¨¡å—é€šå¸¸åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

```
packages/core/src/lib/{æ¨¡å—å}/
â”œâ”€â”€ {æ¨¡å—å}.entity.ts              # å®ä½“å®šä¹‰
â”œâ”€â”€ {æ¨¡å—å}.service.ts             # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ {æ¨¡å—å}.controller.ts          # REST API æ§åˆ¶å™¨
â”œâ”€â”€ {æ¨¡å—å}.module.ts              # NestJS æ¨¡å—å®šä¹‰
â”œâ”€â”€ {æ¨¡å—å}.subscriber.ts          # å®ä½“è®¢é˜…è€…ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ {æ¨¡å—å}.seed.ts                # æ•°æ®ç§å­ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ commands/                        # CQRS å‘½ä»¤å’Œå¤„ç†å™¨
â”‚   â”œâ”€â”€ {æ¨¡å—å}.create.command.ts
â”‚   â”œâ”€â”€ {æ¨¡å—å}.update.command.ts
â”‚   â””â”€â”€ handlers/
â”‚       â”œâ”€â”€ {æ¨¡å—å}.create.handler.ts
â”‚       â””â”€â”€ {æ¨¡å—å}.update.handler.ts
â”œâ”€â”€ repository/                      # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ type-orm-{æ¨¡å—å}.repository.ts    # âŒ éœ€è¦ç§»é™¤
â”‚   â””â”€â”€ mikro-orm-{æ¨¡å—å}.repository.ts   # âœ… ä¿ç•™
â”œâ”€â”€ dto/                             # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ create-{æ¨¡å—å}.dto.ts
â”‚   â””â”€â”€ update-{æ¨¡å—å}.dto.ts
â””â”€â”€ index.ts                         # æ¨¡å—å¯¼å‡º
```

**1.2 æ¨¡å—æå–é€šç”¨æ­¥éª¤**

**æ­¥éª¤æ¨¡æ¿ï¼ˆé€‚ç”¨äºæ‰€æœ‰åŠŸèƒ½æ¨¡å—ï¼‰**ï¼š

```bash
# 1. ç¡®å®šæ¨¡å—åç§°å’Œç›®æ ‡è·¯å¾„
MODULE_NAME="user"  # ä¾‹å¦‚ï¼šuser, organization, employee, tasks
SOURCE_DIR="examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME}"
TARGET_DIR="libs/core/src/lib/${MODULE_NAME}"

# 2. åˆ›å»ºç›®æ ‡ç›®å½•
mkdir -p ${TARGET_DIR}

# 3. å¤åˆ¶æ¨¡å—æºä»£ç 
cp -r ${SOURCE_DIR}/* ${TARGET_DIR}/

# 4. ç§»é™¤ TypeORM Repository
rm -f ${TARGET_DIR}/repository/type-orm-*.repository.ts

# 5. æ›´æ–°å¯¼å…¥è·¯å¾„
find ${TARGET_DIR} -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 6. ä¿®æ”¹æ¨¡å—æ–‡ä»¶ï¼ˆç§»é™¤ TypeORMï¼‰
# éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ {æ¨¡å—å}.module.ts

# 7. æ›´æ–°æ ¸å¿ƒåŒ…çš„ index.ts
# åœ¨ libs/core/src/index.ts ä¸­æ·»åŠ æ¨¡å—å¯¼å‡º
```

**1.3 æ¨¡å—ä¾èµ–å…³ç³»åˆ†æ**

åœ¨æå–æ¨¡å—å‰ï¼Œéœ€è¦åˆ†ææ¨¡å—çš„ä¾èµ–å…³ç³»ï¼š

```bash
# åˆ†ææ¨¡å—ä¾èµ–
cd examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME}

# 1. æ£€æŸ¥æ¨¡å—å¯¼å…¥
grep -r "from '@gauzy/" ${MODULE_NAME}.module.ts ${MODULE_NAME}.service.ts

# 2. æ£€æŸ¥å®ä½“å…³ç³»
grep -r "@ManyToOne\|@OneToMany\|@OneToOne\|@ManyToMany" ${MODULE_NAME}.entity.ts

# 3. æ£€æŸ¥è·¨æ¨¡å—ä¾èµ–
grep -r "import.*from.*\.\./" ${MODULE_NAME}/
```

**1.4 æ¨¡å—ä¼˜å…ˆçº§è¯„ä¼°çŸ©é˜µ**

| æ¨¡å—å | ä¼˜å…ˆçº§ | ä¾èµ–æ¨¡å— | å¤æ‚åº¦ | å·¥ä½œé‡ | è¯´æ˜ |
|--------|--------|----------|--------|--------|------|
| **user** | P0 | auth, role-permission | ä¸­ | 2-3 å¤© | æ ¸å¿ƒæ¨¡å—ï¼Œå…¶ä»–æ¨¡å—ä¾èµ– |
| **organization** | P0 | user, contact | ä¸­ | 2-3 å¤© | æ ¸å¿ƒæ¨¡å—ï¼Œå¤šç§Ÿæˆ·åŸºç¡€ |
| **employee** | P1 | user, organization | é«˜ | 3-4 å¤© | ä¸šåŠ¡æ ¸å¿ƒæ¨¡å— |
| **tasks** | P1 | user, organization, employee | é«˜ | 3-4 å¤© | ä¸šåŠ¡æ ¸å¿ƒæ¨¡å— |
| **role-permission** | P0 | - | ä½ | 1-2 å¤© | æƒé™ç®¡ç†ï¼Œå…¶ä»–æ¨¡å—ä¾èµ– |
| **tenant** | P0 | - | ä½ | 1-2 å¤© | å¤šç§Ÿæˆ·åŸºç¡€ |
| **contact** | P2 | - | ä½ | 1 å¤© | è¾…åŠ©æ¨¡å— |
| **tags** | P2 | - | ä½ | 1 å¤© | è¾…åŠ©æ¨¡å— |

---

###### 2. ç”¨æˆ·æ¨¡å—æå–æŠ€æœ¯æ–¹æ¡ˆ

**2.1 ç”¨æˆ·æ¨¡å—ç»“æ„**

```
libs/core/src/lib/user/
â”œâ”€â”€ user.entity.ts
â”œâ”€â”€ user.service.ts
â”œâ”€â”€ user.controller.ts
â”œâ”€â”€ user.module.ts
â”œâ”€â”€ user.subscriber.ts
â”œâ”€â”€ user.seed.ts
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ user.create.command.ts
â”‚   â”œâ”€â”€ user.update.command.ts
â”‚   â””â”€â”€ handlers/
â”‚       â”œâ”€â”€ user.create.handler.ts
â”‚       â””â”€â”€ user.update.handler.ts
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ mikro-orm-user.repository.ts  # ä»…ä¿ç•™ MikroORM
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-user.dto.ts
â”‚   â””â”€â”€ update-user.dto.ts
â””â”€â”€ index.ts
```

**2.2 ç”¨æˆ·æ¨¡å—æå–æ­¥éª¤**

```bash
# 1. æå–ç”¨æˆ·æ¨¡å—
MODULE_NAME="user"
SOURCE_DIR="examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME}"
TARGET_DIR="libs/core/src/lib/${MODULE_NAME}"

mkdir -p ${TARGET_DIR}
cp -r ${SOURCE_DIR}/* ${TARGET_DIR}/

# 2. ç§»é™¤ TypeORM Repository
rm -f ${TARGET_DIR}/repository/type-orm-user.repository.ts

# 3. æ›´æ–°å¯¼å…¥è·¯å¾„
find ${TARGET_DIR} -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 4. ä¿®æ”¹ user.module.tsï¼ˆè§ä¸‹æ–¹ï¼‰
```

**2.3 ç”¨æˆ·æ¨¡å—æ–‡ä»¶ä¿®æ”¹**

**user.module.ts ä¿®æ”¹**ï¼š

```typescript
// ä¿®æ”¹å‰ï¼š
import { TypeOrmModule } from '@nestjs/typeorm';
import { TypeOrmUserRepository } from './repository/type-orm-user.repository';
import { MikroOrmUserRepository } from './repository/mikro-orm-user.repository';

@Module({
  imports: [
    TypeOrmModule.forFeature([User]),  // âŒ ç§»é™¤
    MikroOrmModule.forFeature([User]),  // âœ… ä¿ç•™
    // ...
  ],
  providers: [
    UserService,
    TypeOrmUserRepository,  // âŒ ç§»é™¤
    MikroOrmUserRepository,  // âœ… ä¿ç•™
    ...CommandHandlers
  ],
  exports: [
    UserService,
    TypeOrmUserRepository,  // âŒ ç§»é™¤
    MikroOrmUserRepository  // âœ… ä¿ç•™
  ]
})

// ä¿®æ”¹åï¼š
import { MikroOrmModule } from '@mikro-orm/nestjs';
import { MikroOrmUserRepository } from './repository/mikro-orm-user.repository';

@Module({
  imports: [
    MikroOrmModule.forFeature([User]),  // âœ… ä»…ä¿ç•™ MikroORM
    // ...
  ],
  providers: [
    UserService,
    MikroOrmUserRepository,  // âœ… ä»…ä¿ç•™ MikroORM
    ...CommandHandlers
  ],
  exports: [
    UserService,
    MikroOrmUserRepository  // âœ… ä»…ä¿ç•™ MikroORM
  ]
})
```

**user.service.ts ä¿®æ”¹**ï¼š

```typescript
// ä¿®æ”¹å‰ï¼š
constructor(
  @InjectRepository(User)
  private readonly typeOrmRepository: Repository<User>,
  private readonly mikroOrmRepository: MikroOrmUserRepository
) {}

// ä¿®æ”¹åï¼š
constructor(
  private readonly mikroOrmRepository: MikroOrmUserRepository
) {}

// ç§»é™¤æ‰€æœ‰ typeOrmRepository çš„ä½¿ç”¨
// ä»…ä½¿ç”¨ mikroOrmRepository
```

**2.4 ç”¨æˆ·æ¨¡å—ä¾èµ–æ£€æŸ¥**

```bash
# æ£€æŸ¥ç”¨æˆ·æ¨¡å—çš„ä¾èµ–
cd libs/core/src/lib/user

# 1. éªŒè¯æ—  TypeORM ä¾èµ–
grep -r "typeorm\|@nestjs/typeorm\|TypeOrmModule" . && echo "âŒ ä»æœ‰ TypeORM ä¾èµ–" || echo "âœ… æ—  TypeORM ä¾èµ–"

# 2. éªŒè¯å¯¼å…¥è·¯å¾„
grep -r "@gauzy/" . && echo "âŒ ä»æœ‰æ—§å¯¼å…¥è·¯å¾„" || echo "âœ… å¯¼å…¥è·¯å¾„æ­£ç¡®"

# 3. éªŒè¯ä¾èµ–æ¨¡å—å­˜åœ¨
grep -r "@oksai/auth\|@oksai/role-permission" . && echo "âœ… ä¾èµ–æ¨¡å—å­˜åœ¨" || echo "âŒ ä¾èµ–æ¨¡å—ç¼ºå¤±"
```

---

###### 3. ç»„ç»‡æ¨¡å—æå–æŠ€æœ¯æ–¹æ¡ˆ

**3.1 ç»„ç»‡æ¨¡å—ç»“æ„**

```
libs/core/src/lib/organization/
â”œâ”€â”€ organization.entity.ts
â”œâ”€â”€ organization.service.ts
â”œâ”€â”€ organization.controller.ts
â”œâ”€â”€ organization.module.ts
â”œâ”€â”€ organization.subscriber.ts
â”œâ”€â”€ organization.seed.ts
â”œâ”€â”€ commands/
â”‚   â””â”€â”€ handlers/
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ mikro-orm-organization.repository.ts
â””â”€â”€ dto/
```

**3.2 ç»„ç»‡æ¨¡å—æå–æ­¥éª¤**

```bash
# 1. æå–ç»„ç»‡æ¨¡å—
MODULE_NAME="organization"
SOURCE_DIR="examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME}"
TARGET_DIR="libs/core/src/lib/${MODULE_NAME}"

mkdir -p ${TARGET_DIR}
cp -r ${SOURCE_DIR}/* ${TARGET_DIR}/

# 2. ç§»é™¤ TypeORM Repository
rm -f ${TARGET_DIR}/repository/type-orm-organization.repository.ts

# 3. æ›´æ–°å¯¼å…¥è·¯å¾„
find ${TARGET_DIR} -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 4. ä¿®æ”¹ organization.module.tsï¼ˆç±»ä¼¼ user.module.tsï¼‰
```

**3.3 ç»„ç»‡æ¨¡å—ç‰¹æ®Šå¤„ç†**

- **ä¾èµ–å…³ç³»**ï¼šç»„ç»‡æ¨¡å—ä¾èµ– userã€contactã€role-permission
- **å¤šç§Ÿæˆ·æ”¯æŒ**ï¼šç»„ç»‡æ˜¯ç§Ÿæˆ·ä¸‹çš„å®ä½“ï¼Œéœ€è¦ç¡®ä¿å¤šç§Ÿæˆ·é€»è¾‘æ­£ç¡®
- **å®ä½“å…³ç³»**ï¼šæ£€æŸ¥ä¸å…¶ä»–æ¨¡å—çš„å®ä½“å…³ç³»ï¼ˆå¦‚ employeeã€project ç­‰ï¼‰

---

###### 4. å‘˜å·¥æ¨¡å—æå–æŠ€æœ¯æ–¹æ¡ˆ

**4.1 å‘˜å·¥æ¨¡å—ç»“æ„**

```
libs/core/src/lib/employee/
â”œâ”€â”€ employee.entity.ts
â”œâ”€â”€ employee.service.ts
â”œâ”€â”€ employee.controller.ts
â”œâ”€â”€ employee.module.ts
â”œâ”€â”€ managed-employee.service.ts  # ç‰¹æ®ŠæœåŠ¡
â”œâ”€â”€ employee.subscriber.ts
â”œâ”€â”€ employee.seed.ts
â”œâ”€â”€ commands/
â”œâ”€â”€ repository/
â””â”€â”€ dto/
```

**4.2 å‘˜å·¥æ¨¡å—æå–æ­¥éª¤**

```bash
# 1. æå–å‘˜å·¥æ¨¡å—
MODULE_NAME="employee"
SOURCE_DIR="examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME}"
TARGET_DIR="libs/core/src/lib/${MODULE_NAME}"

mkdir -p ${TARGET_DIR}
cp -r ${SOURCE_DIR}/* ${TARGET_DIR}/

# 2. ç§»é™¤ TypeORM Repository
rm -f ${TARGET_DIR}/repository/type-orm-employee.repository.ts

# 3. æ›´æ–°å¯¼å…¥è·¯å¾„
find ${TARGET_DIR} -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 4. æ£€æŸ¥ä¾èµ–æ¨¡å—ï¼ˆuser, organizationï¼‰
# ç¡®ä¿è¿™äº›æ¨¡å—å·²æå–
```

**4.3 å‘˜å·¥æ¨¡å—ç‰¹æ®Šå¤„ç†**

- **å¤æ‚å®ä½“å…³ç³»**ï¼šå‘˜å·¥ä¸ç”¨æˆ·ã€ç»„ç»‡ã€ä»»åŠ¡ç­‰æœ‰å¤æ‚å…³ç³»
- **ç®¡ç†æœåŠ¡**ï¼š`managed-employee.service.ts` éœ€è¦ç‰¹åˆ«æ£€æŸ¥
- **ä¸šåŠ¡é€»è¾‘**ï¼šå‘˜å·¥æ¨¡å—åŒ…å«è¾ƒå¤šä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ä»”ç»†éªŒè¯

---

###### 5. ä»»åŠ¡æ¨¡å—æå–æŠ€æœ¯æ–¹æ¡ˆ

**5.1 ä»»åŠ¡æ¨¡å—ç»“æ„**

```
libs/core/src/lib/tasks/
â”œâ”€â”€ task.entity.ts
â”œâ”€â”€ task.service.ts
â”œâ”€â”€ task.controller.ts
â”œâ”€â”€ task.module.ts
â”œâ”€â”€ task.subscriber.ts
â”œâ”€â”€ task.seed.ts
â”œâ”€â”€ commands/
â”œâ”€â”€ repository/
â”œâ”€â”€ dto/
â”œâ”€â”€ daily-plan/          # å­æ¨¡å—
â”œâ”€â”€ estimation/          # å­æ¨¡å—
â”œâ”€â”€ issue-type/          # å­æ¨¡å—
â”œâ”€â”€ linked-issue/        # å­æ¨¡å—
â”œâ”€â”€ priorities/          # å­æ¨¡å—
â”œâ”€â”€ related-issue-type/  # å­æ¨¡å—
â”œâ”€â”€ screening-tasks/     # å­æ¨¡å—
â”œâ”€â”€ sizes/              # å­æ¨¡å—
â”œâ”€â”€ statuses/            # å­æ¨¡å—
â”œâ”€â”€ versions/            # å­æ¨¡å—
â””â”€â”€ views/               # å­æ¨¡å—
```

**5.2 ä»»åŠ¡æ¨¡å—æå–æ­¥éª¤**

```bash
# 1. æå–ä»»åŠ¡æ¨¡å—ï¼ˆåŒ…å«æ‰€æœ‰å­æ¨¡å—ï¼‰
MODULE_NAME="tasks"
SOURCE_DIR="examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME}"
TARGET_DIR="libs/core/src/lib/${MODULE_NAME}"

mkdir -p ${TARGET_DIR}
cp -r ${SOURCE_DIR}/* ${TARGET_DIR}/

# 2. ç§»é™¤æ‰€æœ‰ TypeORM Repository
find ${TARGET_DIR} -name "type-orm-*.repository.ts" -delete

# 3. æ›´æ–°å¯¼å…¥è·¯å¾„
find ${TARGET_DIR} -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 4. æ£€æŸ¥å­æ¨¡å—çš„ä¾èµ–å…³ç³»
# ä»»åŠ¡æ¨¡å—åŒ…å«å¤šä¸ªå­æ¨¡å—ï¼Œéœ€è¦é€ä¸€æ£€æŸ¥
```

**5.3 ä»»åŠ¡æ¨¡å—ç‰¹æ®Šå¤„ç†**

- **å­æ¨¡å—å¤æ‚**ï¼šä»»åŠ¡æ¨¡å—åŒ…å«å¤šä¸ªå­æ¨¡å—ï¼Œéœ€è¦é€ä¸€æå–å’ŒéªŒè¯
- **å®ä½“å…³ç³»å¤æ‚**ï¼šä»»åŠ¡ä¸ç”¨æˆ·ã€ç»„ç»‡ã€å‘˜å·¥ã€é¡¹ç›®ç­‰æœ‰å¤æ‚å…³ç³»
- **ä¸šåŠ¡é€»è¾‘å¤æ‚**ï¼šä»»åŠ¡æ¨¡å—åŒ…å«å¤§é‡ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ä»”ç»†æµ‹è¯•

---

###### 6. æ¨¡å—æå–é€šç”¨ä¿®æ”¹æ¸…å•

**6.1 æ¨¡å—æ–‡ä»¶ä¿®æ”¹æ¸…å•**

å¯¹æ¯ä¸ªæ¨¡å—ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹ä¿®æ”¹ï¼š

- [ ] **ç§»é™¤ TypeORM å¯¼å…¥**
  ```typescript
  // ç§»é™¤ï¼š
  import { TypeOrmModule } from '@nestjs/typeorm';
  import { Repository } from 'typeorm';
  ```

- [ ] **ç§»é™¤ TypeORM Repository**
  ```bash
  rm -f repository/type-orm-*.repository.ts
  ```

- [ ] **ä¿®æ”¹æ¨¡å—å®šä¹‰**
  ```typescript
  // ç§»é™¤ TypeOrmModule.forFeature([Entity])
  // ä»…ä¿ç•™ MikroOrmModule.forFeature([Entity])
  ```

- [ ] **ä¿®æ”¹æœåŠ¡æ„é€ å‡½æ•°**
  ```typescript
  // ç§»é™¤ typeOrmRepository å‚æ•°
  // ä»…ä¿ç•™ mikroOrmRepository
  ```

- [ ] **æ›´æ–°å¯¼å…¥è·¯å¾„**
  ```bash
  find . -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;
  ```

- [ ] **æ›´æ–°å®ä½“è£…é¥°å™¨**
  ```typescript
  // ç§»é™¤ TypeORM è£…é¥°å™¨
  // ä»…ä¿ç•™ MikroORM è£…é¥°å™¨
  ```

**6.2 æ¨¡å—ä¾èµ–éªŒè¯æ¸…å•**

- [ ] **æ£€æŸ¥æ¨¡å—ä¾èµ–**
  ```bash
  # éªŒè¯ä¾èµ–æ¨¡å—å·²æå–
  grep -r "@oksai/" ${MODULE_NAME}.module.ts
  ```

- [ ] **æ£€æŸ¥å®ä½“å…³ç³»**
  ```bash
  # éªŒè¯å®ä½“å…³ç³»æ­£ç¡®
  grep -r "@ManyToOne\|@OneToMany" ${MODULE_NAME}.entity.ts
  ```

- [ ] **æ£€æŸ¥å¯¼å…¥è·¯å¾„**
  ```bash
  # éªŒè¯æ— æ—§å¯¼å…¥è·¯å¾„
  grep -r "@gauzy/" ${MODULE_NAME}/
  ```

---

###### 7. æ¨¡å—æµ‹è¯•æ–¹æ¡ˆ

**7.1 å•å…ƒæµ‹è¯•æå–**

```bash
# 1. æŸ¥æ‰¾æµ‹è¯•æ–‡ä»¶
find examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME} -name "*.spec.ts"

# 2. å¤åˆ¶æµ‹è¯•æ–‡ä»¶
cp examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME}/*.spec.ts libs/core/src/lib/${MODULE_NAME}/

# 3. æ›´æ–°æµ‹è¯•æ–‡ä»¶å¯¼å…¥è·¯å¾„
find libs/core/src/lib/${MODULE_NAME} -name "*.spec.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 4. ä¿®æ”¹æµ‹è¯•æ–‡ä»¶ï¼ˆç§»é™¤ TypeORM ç›¸å…³æµ‹è¯•ï¼‰
# éœ€è¦æ‰‹åŠ¨æ£€æŸ¥å¹¶ä¿®æ”¹æµ‹è¯•æ–‡ä»¶
```

**7.2 æ¨¡å—åŠŸèƒ½æµ‹è¯•**

**æµ‹è¯•æ¸…å•**ï¼š

```typescript
// ç¤ºä¾‹ï¼šç”¨æˆ·æ¨¡å—æµ‹è¯•
describe('UserModule', () => {
  // 1. æ¨¡å—åŠ è½½æµ‹è¯•
  it('should load module', async () => {
    const module = await Test.createTestingModule({
      imports: [UserModule]
    }).compile();
    
    expect(module).toBeDefined();
  });

  // 2. æœåŠ¡æ³¨å…¥æµ‹è¯•
  it('should inject UserService', async () => {
    const module = await Test.createTestingModule({
      imports: [UserModule]
    }).compile();
    
    const service = module.get<UserService>(UserService);
    expect(service).toBeDefined();
  });

  // 3. CRUD åŠŸèƒ½æµ‹è¯•
  it('should create user', async () => {
    // æµ‹è¯•åˆ›å»ºç”¨æˆ·åŠŸèƒ½
  });

  it('should update user', async () => {
    // æµ‹è¯•æ›´æ–°ç”¨æˆ·åŠŸèƒ½
  });

  it('should delete user', async () => {
    // æµ‹è¯•åˆ é™¤ç”¨æˆ·åŠŸèƒ½
  });
});
```

**7.3 æ¨¡å—é›†æˆæµ‹è¯•**

```typescript
// ç¤ºä¾‹ï¼šç”¨æˆ·æ¨¡å—é›†æˆæµ‹è¯•
describe('UserModule Integration', () => {
  let app: INestApplication;
  let userService: UserService;

  beforeAll(async () => {
    const module = await Test.createTestingModule({
      imports: [
        UserModule,
        // å…¶ä»–ä¾èµ–æ¨¡å—
      ]
    }).compile();

    app = module.createNestApplication();
    await app.init();

    userService = module.get<UserService>(UserService);
  });

  afterAll(async () => {
    await app.close();
  });

  it('should create and retrieve user', async () => {
    // é›†æˆæµ‹è¯•
  });
});
```

---

###### 8. æ¨¡å—å¯¼å‡ºå’Œæ³¨å†Œ

**8.1 æ›´æ–°æ ¸å¿ƒåŒ…å¯¼å‡º**

**libs/core/src/index.ts**ï¼š

```typescript
// æ·»åŠ æ¨¡å—å¯¼å‡º
export { UserModule, UserService } from './lib/user';
export { OrganizationModule, OrganizationService } from './lib/organization';
export { EmployeeModule, EmployeeService } from './lib/employee';
export { TaskModule, TaskService } from './lib/tasks';

// æ·»åŠ å®ä½“å¯¼å‡º
export { User } from './lib/user';
export { Organization } from './lib/organization';
export { Employee } from './lib/employee';
export { Task } from './lib/tasks';

// æ·»åŠ å‘½ä»¤å¯¼å‡º
export { UserCreateCommand, UserUpdateCommand } from './lib/user/commands';
export { OrganizationCreateCommand } from './lib/organization/commands';
// ...
```

**8.2 åœ¨ API åº”ç”¨ä¸­æ³¨å†Œæ¨¡å—**

**apps/api/src/app.module.ts**ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼š

```typescript
import { Module } from '@nestjs/common';
import { UserModule } from '@oksai/core';
import { OrganizationModule } from '@oksai/core';
import { EmployeeModule } from '@oksai/core';
import { TaskModule } from '@oksai/core';

@Module({
  imports: [
    UserModule,
    OrganizationModule,
    EmployeeModule,
    TaskModule,
    // å…¶ä»–æ¨¡å—...
  ],
})
export class AppModule {}
```

---

###### 9. è‡ªåŠ¨åŒ–è„šæœ¬

**9.1 æ¨¡å—æå–è„šæœ¬**

åˆ›å»º `scripts/extract-module.sh`ï¼š

```bash
#!/bin/bash
# æå–åŠŸèƒ½æ¨¡å—çš„é€šç”¨è„šæœ¬

MODULE_NAME=$1

if [ -z "$MODULE_NAME" ]; then
  echo "ç”¨æ³•: ./extract-module.sh <æ¨¡å—å>"
  echo "ç¤ºä¾‹: ./extract-module.sh user"
  exit 1
fi

SOURCE_DIR="examples/ever-gauzy/packages/core/src/lib/${MODULE_NAME}"
TARGET_DIR="libs/core/src/lib/${MODULE_NAME}"

echo "å¼€å§‹æå–æ¨¡å—: ${MODULE_NAME}..."

# 1. æ£€æŸ¥æºç›®å½•æ˜¯å¦å­˜åœ¨
if [ ! -d "$SOURCE_DIR" ]; then
  echo "âŒ æºç›®å½•ä¸å­˜åœ¨: $SOURCE_DIR"
  exit 1
fi

# 2. åˆ›å»ºç›®æ ‡ç›®å½•
mkdir -p ${TARGET_DIR}

# 3. å¤åˆ¶æºä»£ç 
echo "å¤åˆ¶æºä»£ç ..."
cp -r ${SOURCE_DIR}/* ${TARGET_DIR}/

# 4. ç§»é™¤ TypeORM Repository
echo "ç§»é™¤ TypeORM Repository..."
find ${TARGET_DIR} -name "type-orm-*.repository.ts" -delete

# 5. æ›´æ–°å¯¼å…¥è·¯å¾„
echo "æ›´æ–°å¯¼å…¥è·¯å¾„..."
find ${TARGET_DIR} -type f -name "*.ts" -exec sed -i 's/@gauzy\//@oksai\//g' {} \;

# 6. æ£€æŸ¥ä¾èµ–
echo "æ£€æŸ¥ä¾èµ–..."
grep -r "@gauzy/" ${TARGET_DIR} && echo "âš ï¸  ä»æœ‰æ—§å¯¼å…¥è·¯å¾„ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥" || echo "âœ… å¯¼å…¥è·¯å¾„å·²æ›´æ–°"

echo "âœ… æ¨¡å— ${MODULE_NAME} æå–å®Œæˆ"
echo "âš ï¸  è¯·æ‰‹åŠ¨ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š"
echo "   - ${TARGET_DIR}/${MODULE_NAME}.module.ts"
echo "   - ${TARGET_DIR}/${MODULE_NAME}.service.ts"
echo "   - ${TARGET_DIR}/repository/mikro-orm-${MODULE_NAME}.repository.ts"
```

**9.2 æ¨¡å—éªŒè¯è„šæœ¬**

åˆ›å»º `scripts/verify-module.sh`ï¼š

```bash
#!/bin/bash
# éªŒè¯æ¨¡å—æå–ç»“æœ

MODULE_NAME=$1

if [ -z "$MODULE_NAME" ]; then
  echo "ç”¨æ³•: ./verify-module.sh <æ¨¡å—å>"
  exit 1
fi

MODULE_DIR="libs/core/src/lib/${MODULE_NAME}"

echo "éªŒè¯æ¨¡å—: ${MODULE_NAME}..."

# 1. æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
if [ ! -d "$MODULE_DIR" ]; then
  echo "âŒ æ¨¡å—ç›®å½•ä¸å­˜åœ¨: $MODULE_DIR"
  exit 1
fi

# 2. æ£€æŸ¥ TypeORM ä¾èµ–
echo "æ£€æŸ¥ TypeORM ä¾èµ–..."
grep -r "typeorm\|@nestjs/typeorm\|TypeOrmModule" ${MODULE_DIR} && echo "âŒ ä»æœ‰ TypeORM ä¾èµ–" || echo "âœ… æ—  TypeORM ä¾èµ–"

# 3. æ£€æŸ¥å¯¼å…¥è·¯å¾„
echo "æ£€æŸ¥å¯¼å…¥è·¯å¾„..."
grep -r "@gauzy/" ${MODULE_DIR} && echo "âŒ ä»æœ‰æ—§å¯¼å…¥è·¯å¾„" || echo "âœ… å¯¼å…¥è·¯å¾„æ­£ç¡®"

# 4. æ£€æŸ¥æ¨¡å—æ–‡ä»¶
echo "æ£€æŸ¥æ¨¡å—æ–‡ä»¶..."
[ -f "${MODULE_DIR}/${MODULE_NAME}.module.ts" ] && echo "âœ… æ¨¡å—æ–‡ä»¶å­˜åœ¨" || echo "âŒ æ¨¡å—æ–‡ä»¶ç¼ºå¤±"
[ -f "${MODULE_DIR}/${MODULE_NAME}.service.ts" ] && echo "âœ… æœåŠ¡æ–‡ä»¶å­˜åœ¨" || echo "âŒ æœåŠ¡æ–‡ä»¶ç¼ºå¤±"
[ -f "${MODULE_DIR}/${MODULE_NAME}.entity.ts" ] && echo "âœ… å®ä½“æ–‡ä»¶å­˜åœ¨" || echo "âŒ å®ä½“æ–‡ä»¶ç¼ºå¤±"

# 5. æ£€æŸ¥ Repository
echo "æ£€æŸ¥ Repository..."
[ -f "${MODULE_DIR}/repository/mikro-orm-${MODULE_NAME}.repository.ts" ] && echo "âœ… MikroORM Repository å­˜åœ¨" || echo "âŒ MikroORM Repository ç¼ºå¤±"
[ -f "${MODULE_DIR}/repository/type-orm-${MODULE_NAME}.repository.ts" ] && echo "âŒ TypeORM Repository ä»å­˜åœ¨" || echo "âœ… TypeORM Repository å·²ç§»é™¤"

echo "âœ… æ¨¡å—éªŒè¯å®Œæˆ"
```

---

###### 10. æ¨¡å—æå–ä¼˜å…ˆçº§å»ºè®®

**å»ºè®®æå–é¡ºåº**ï¼š

1. **ç¬¬ä¸€é˜¶æ®µï¼ˆæ ¸å¿ƒåŸºç¡€æ¨¡å—ï¼‰**ï¼š
   - `tenant` - å¤šç§Ÿæˆ·åŸºç¡€
   - `role-permission` - æƒé™ç®¡ç†
   - `user` - ç”¨æˆ·ç®¡ç†

2. **ç¬¬äºŒé˜¶æ®µï¼ˆç»„ç»‡ç›¸å…³æ¨¡å—ï¼‰**ï¼š
   - `organization` - ç»„ç»‡ç®¡ç†
   - `contact` - è”ç³»äººç®¡ç†

3. **ç¬¬ä¸‰é˜¶æ®µï¼ˆä¸šåŠ¡æ ¸å¿ƒæ¨¡å—ï¼‰**ï¼š
   - `employee` - å‘˜å·¥ç®¡ç†
   - `tasks` - ä»»åŠ¡ç®¡ç†

4. **ç¬¬å››é˜¶æ®µï¼ˆè¾…åŠ©æ¨¡å—ï¼‰**ï¼š
   - `tags` - æ ‡ç­¾ç®¡ç†
   - `comments` - è¯„è®ºç®¡ç†
   - å…¶ä»–ä¸šåŠ¡æ¨¡å—ï¼ˆæŒ‰éœ€ï¼‰

**æå–åŸåˆ™**ï¼š
- å…ˆæå–ä¾èµ–å°‘çš„æ¨¡å—
- å…ˆæå–æ ¸å¿ƒåŸºç¡€æ¨¡å—
- æŒ‰ä¸šåŠ¡ä¼˜å…ˆçº§æå–
- æ¯ä¸ªæ¨¡å—æå–åç«‹å³éªŒè¯

---

#### ç¬¬äº”é˜¶æ®µï¼šä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆ1-2 å‘¨ï¼‰

**ç›®æ ‡**ï¼šä»£ç ä¼˜åŒ–ã€æµ‹è¯•è¡¥å……å’Œæ–‡æ¡£å®Œå–„

**ä»»åŠ¡æ¸…å•**ï¼š
1. **ä»£ç é‡æ„å’Œä¼˜åŒ–**
   - æ ¹æ®é¡¹ç›®éœ€æ±‚è°ƒæ•´æ¶æ„
   - ä¼˜åŒ–ä»£ç ç»“æ„
   - æ·»åŠ ä¸­æ–‡æ³¨é‡Šï¼ˆTSDocï¼‰
   - **éªŒè¯**ï¼šä»£ç è´¨é‡è¾¾æ ‡

2. **è¡¥å……æµ‹è¯•ç”¨ä¾‹**
   - å•å…ƒæµ‹è¯•ï¼ˆæ ¸å¿ƒä¸šåŠ¡ 80%+ï¼‰
   - é›†æˆæµ‹è¯•
   - ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå…³é”®è·¯å¾„ï¼‰
   - **éªŒè¯**ï¼šæµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
   - ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
   - å¯åŠ¨æ€§èƒ½ä¼˜åŒ–
   - **éªŒè¯**ï¼šæ€§èƒ½æŒ‡æ ‡è¾¾æ ‡

4. **æ–‡æ¡£ç¼–å†™**
   - æŠ€æœ¯æ–‡æ¡£
   - API æ–‡æ¡£
   - éƒ¨ç½²æ–‡æ¡£
   - **éªŒè¯**ï¼šæ–‡æ¡£å®Œæ•´å‡†ç¡®

**éªŒè¯æ ‡å‡†**ï¼š
- âœ… ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡ï¼ˆæ ¸å¿ƒä¸šåŠ¡ 80%+ï¼‰
- âœ… æ€§èƒ½æŒ‡æ ‡æ»¡è¶³è¦æ±‚
- âœ… æ–‡æ¡£å®Œæ•´å‡†ç¡®

**å¯äº¤ä»˜æˆæœ**ï¼š
- ä¼˜åŒ–åçš„ä»£ç 
- å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
- æŠ€æœ¯æ–‡æ¡£å’Œ API æ–‡æ¡£

### 6.3 æˆåŠŸæ ‡å‡†

1. âœ… é¡¹ç›®ä½¿ç”¨ Turbo æ„å»ºï¼Œæ—  Nx ä¾èµ–
2. âœ… åç«¯ä»£ç å®Œæ•´æå–ï¼Œæ— å‰ç«¯ä¾èµ–
3. âœ… **ORM å±‚å·²ç®€åŒ–**ï¼šä»…ä½¿ç”¨ MikroORMï¼Œæ—  TypeORM å’Œ ORM æŠ½è±¡å±‚ï¼Œæ”¯æŒ PostgreSQLã€MongoDBã€Better-SQLite ä¸‰ç§æ•°æ®åº“
4. âœ… API åº”ç”¨å¯æ­£å¸¸å¯åŠ¨
5. âœ… æ•°æ®åº“è¿ç§»æ­£å¸¸æ‰§è¡Œï¼ˆä½¿ç”¨ MikroORMï¼‰
6. âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡ï¼ˆæ ¸å¿ƒä¸šåŠ¡ 80%+ï¼‰
7. âœ… ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒï¼ˆTSDoc ä¸­æ–‡æ³¨é‡Šï¼‰

---

## 7. é™„å½•

### 7.1 å‚è€ƒæ–‡æ¡£

- [Turbo å®˜æ–¹æ–‡æ¡£](https://turbo.build/repo/docs)
- [NestJS å®˜æ–¹æ–‡æ¡£](https://docs.nestjs.com/)
- [MikroORM å®˜æ–¹æ–‡æ¡£](https://mikro-orm.io/docs)
- [ever-gauzy GitHub](https://github.com/ever-co/ever-gauzy)
- [XS-001 ever-gauzy æ¶æ„è®¾è®¡åˆ†æ](./XS-001-ever-gauzyæ¶æ„è®¾è®¡åˆ†æ.md) - æœ¬é¡¹ç›®çš„æ¶æ„åˆ†ææ–‡æ¡£

### 7.2 ç›¸å…³æ–‡ä»¶

- `turbo.json` - Turbo é…ç½®æ–‡ä»¶
- `package.json` - é¡¹ç›®ä¾èµ–é…ç½®
- `tsconfig.json` - TypeScript é…ç½®
- `examples/ever-gauzy/` - å‚è€ƒé¡¹ç›®

### 7.3 æœ¯è¯­è¡¨

- **Nx**: ä¸€ä¸ªå¼ºå¤§çš„ monorepo å·¥å…·ï¼Œæä¾›ä»£ç ç”Ÿæˆã€ä¾èµ–å›¾åˆ†æç­‰åŠŸèƒ½
- **Turbo**: ä¸€ä¸ªé«˜æ€§èƒ½çš„ monorepo æ„å»ºå·¥å…·ï¼Œä¸“æ³¨äºæ„å»ºç¼“å­˜å’Œä»»åŠ¡ç¼–æ’
- **Monorepo**: å°†å¤šä¸ªç›¸å…³é¡¹ç›®æ”¾åœ¨åŒä¸€ä¸ªä»£ç ä»“åº“ä¸­çš„å¼€å‘æ–¹å¼
- **MikroORM**: ä¸€ä¸ª TypeScript ORM æ¡†æ¶ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨å…¶ä½œä¸ºå”¯ä¸€æ•°æ®è®¿é—®å±‚
- **TypeORM**: å¦ä¸€ä¸ª TypeScript ORM æ¡†æ¶ï¼Œæœ¬é¡¹ç›®**ä¸ä½¿ç”¨**ï¼Œå·²ä» ever-gauzy ä¸­ç§»é™¤
- **CQRS**: Command Query Responsibility Segregationï¼Œå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»
- **EDA**: Event-Driven Architectureï¼Œäº‹ä»¶é©±åŠ¨æ¶æ„
  - é€šè¿‡äº‹ä»¶æ€»çº¿å®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼
  - æ”¯æŒè·¨æ¨¡å—çš„å¼‚æ­¥äº‹ä»¶é€šä¿¡
  - äº‹ä»¶ä»…åœ¨å†…å­˜ä¸­æµè½¬ï¼ˆå¦‚ ever-gauzy çš„å®ç°ï¼‰
- **ES**: Event Sourcingï¼Œäº‹ä»¶æº¯æº
  - å°†æ‰€æœ‰çŠ¶æ€å˜æ›´å­˜å‚¨ä¸ºä¸å¯å˜çš„äº‹ä»¶åºåˆ—
  - é€šè¿‡é‡æ”¾äº‹ä»¶é‡å»ºèšåˆæ ¹çŠ¶æ€
  - éœ€è¦äº‹ä»¶å­˜å‚¨ï¼ˆEvent Storeï¼‰æŒä¹…åŒ–äº‹ä»¶
  - **æ³¨æ„**: ever-gauzy æœªå®ç°å®Œæ•´çš„äº‹ä»¶æº¯æºï¼Œä»…å®ç°äº†äº‹ä»¶é©±åŠ¨æ¶æ„

---

## 8. å®¡æ‰¹è®°å½•

| è§’è‰² | å§“å | æ—¥æœŸ | æ„è§ | ç­¾å |
|------|------|------|------|------|
| æŠ€æœ¯è´Ÿè´£äºº | | | | |
| æ¶æ„å¸ˆ | | | | |
| é¡¹ç›®ç»ç† | | | | |

---

**æ–‡æ¡£ç»“æŸ**
